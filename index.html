<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HoloSpot - Colocando os holofotes nos outros</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HKK75JRY5W"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-HKK75JRY5W');
        
        function trackEvent(eventName, parameters = {}) {
            gtag('event', eventName, parameters);
            console.log('📊 Event tracked:', eventName, parameters);
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #764ba2;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFF 30%, transparent 70%);
            border-radius: 50%;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            background: conic-gradient(from 0deg, transparent 0deg, rgba(255, 215, 0, 0.3) 45deg, transparent 90deg, rgba(255, 215, 0, 0.3) 135deg, transparent 180deg, rgba(255, 215, 0, 0.3) 225deg, transparent 270deg, rgba(255, 215, 0, 0.3) 315deg, transparent 360deg);
            border-radius: 50%;
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notifications {
            position: relative;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            background: rgba(118, 75, 162, 0.1);
            transition: all 0.3s ease;
        }

        .notifications:hover {
            background: rgba(118, 75, 162, 0.2);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .notification-item:hover {
            background: #f8f9fa;
        }

        .notification-item.unread {
            background: rgba(118, 75, 162, 0.05);
            border-left: 3px solid #764ba2;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-name {
            font-weight: 600;
            color: #333;
        }

        .logout-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #ff3742;
            transform: translateY(-1px);
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .login-logo .logo-icon {
            width: 60px;
            height: 60px;
        }

        .login-title {
            font-size: 2rem;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .google-login-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            transition: all 0.3s ease;
        }

        .google-login-btn:hover {
            border-color: #4285f4;
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.2);
            transform: translateY(-2px);
        }

        /* Main App */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: none;
        }

        .app-container.active {
            display: block;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            min-width: 120px;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .nav-tab:not(.active):hover {
            background: rgba(118, 75, 162, 0.1);
            transform: translateY(-1px);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Posts */
        .posts-container {
            display: grid;
            gap: 1.5rem;
        }

        .post {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .post:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .post-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .post-author {
            flex: 1;
        }

        .post-author-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.2rem;
        }

        .post-time {
            color: #666;
            font-size: 0.9rem;
        }

        .follow-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .follow-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .follow-btn.following {
            background: #28a745;
        }

        .post-content {
            margin-bottom: 1rem;
        }

        .post-person {
            font-weight: 600;
            color: #764ba2;
            margin-bottom: 0.5rem;
        }

        .post-type {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .post-story {
            color: #555;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .post-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .post-reactions {
            display: flex;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .reaction-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .reaction-btn:hover {
            background: rgba(118, 75, 162, 0.1);
            transform: translateY(-1px);
        }

        .reaction-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* Create Post Form */
        .create-post-form {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            resize: vertical;
        }

        .form-input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(118, 75, 162, 0.1);
        }

        .highlight-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .highlight-type {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .highlight-type:hover {
            border-color: #764ba2;
            transform: translateY(-2px);
        }

        .highlight-type.selected {
            border-color: #764ba2;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .highlight-type-emoji {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .highlight-type-name {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .highlight-type-desc {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .photo-upload-section {
            margin-bottom: 1.5rem;
        }

        .photo-upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .photo-upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .photo-preview {
            margin-top: 1rem;
            text-align: center;
        }

        .photo-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            object-fit: cover;
        }

        .remove-photo-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Profile & Impact Tabs */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .evolution-chart {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .progress-bar {
            background: #f0f0f0;
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            color: #666;
            text-align: right;
        }

        /* Following/Followers */
        .follow-stats {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .follow-stat {
            text-align: center;
            cursor: pointer;
            padding: 1rem;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .follow-stat:hover {
            background: rgba(118, 75, 162, 0.1);
        }

        .follow-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #764ba2;
        }

        .follow-label {
            color: #666;
            font-size: 0.9rem;
                .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            margin: 0 0 15px 0;
            color: #6366f1;
        }

        .follow-list {
            margin: 15px 0;
        }

        .follow-item {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
            color: #374151;
        }

        .follow-item:last-child {
            border-bottom: none;
        }

        .modal-content button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
        }

        .modal-content button:hover {
            background: #5856eb;
        }

        /* Responsive design */
        @media (max-width: 768px) {         .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .app-container {
                padding: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .nav-tab {
                min-width: auto;
                flex: none;
                padding: 0.8rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .follow-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .highlight-types {
                grid-template-columns: 1fr;
            }
        }

        /* Hidden file input */
        #photoUpload {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <div class="logo-icon"></div>
                <div class="login-title">HoloSpot</div>
            </div>
            <p class="login-subtitle">Colocando os holofotes nos outros</p>
            <button id="loginBtn" class="google-login-btn">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Entrar com Google
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon"></div>
                    <span>HoloSpot</span>
                </div>
                <div class="user-info">
                    <div class="notifications" id="notificationsBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                        </svg>
                        <div class="notification-badge" id="notificationBadge" style="display: none;">0</div>
                        <div class="notification-dropdown" id="notificationDropdown">
                            <div class="notification-item">
                                <strong>Bem-vindo ao HoloSpot!</strong><br>
                                <small>Comece destacando alguém especial</small>
                            </div>
                        </div>
                    </div>
                    <img id="userAvatar" class="user-avatar" src="" alt="Avatar">
                    <span id="userName" class="user-name"></span>
                    <button id="logoutBtn" class="logout-btn">Sair</button>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="inicio">🏠 Início</div>
            <div class="nav-tab" data-tab="destacar">✨ Destacar</div>
            <div class="nav-tab" data-tab="perfil">👤 Perfil</div>
            <div class="nav-tab" data-tab="impacto">📊 Impacto</div>
        </div>

        <!-- Tab Contents -->
        <div id="inicioTab" class="tab-content active">
            <div id="postsContainer" class="posts-container">
                <!-- Posts will be loaded here -->
            </div>
        </div>

        <div id="destacarTab" class="tab-content">
            <div class="create-post-form">
                <h2 style="margin-bottom: 1.5rem; color: #764ba2;">✨ Destacar Alguém</h2>
                
                <div class="form-group">
                    <label class="form-label">Sobre quem você quer falar?</label>
                    <input type="text" id="personName" class="form-input" placeholder="Nome da pessoa...">
                </div>

                <div class="form-group">
                    <label class="form-label">Que tipo de destaque é esse?</label>
                    <div class="highlight-types">
                        <div class="highlight-type" data-type="gratidao">
                            <div class="highlight-type-emoji">🙏</div>
                            <div class="highlight-type-name">Gratidão</div>
                            <div class="highlight-type-desc">Agradecer por algo</div>
                        </div>
                        <div class="highlight-type" data-type="memoria">
                            <div class="highlight-type-emoji">💭</div>
                            <div class="highlight-type-name">Memória</div>
                            <div class="highlight-type-desc">Lembrar momentos especiais</div>
                        </div>
                        <div class="highlight-type" data-type="conquista">
                            <div class="highlight-type-emoji">🏆</div>
                            <div class="highlight-type-name">Conquista</div>
                            <div class="highlight-type-desc">Celebrar vitórias</div>
                        </div>
                        <div class="highlight-type" data-type="inspiracao">
                            <div class="highlight-type-emoji">✨</div>
                            <div class="highlight-type-name">Inspiração</div>
                            <div class="highlight-type-desc">Reconhecer exemplo</div>
                        </div>
                        <div class="highlight-type" data-type="apoio">
                            <div class="highlight-type-emoji">🤝</div>
                            <div class="highlight-type-name">Apoio</div>
                            <div class="highlight-type-desc">Valorizar suporte</div>
                        </div>
                        <div class="highlight-type" data-type="admiracao">
                            <div class="highlight-type-emoji">🌟</div>
                            <div class="highlight-type-name">Admiração</div>
                            <div class="highlight-type-desc">Expressar respeito</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Conte sua história</label>
                    <textarea id="storyText" class="form-input" rows="4" placeholder="Por que essa pessoa merece destaque? O que ela fez de especial?"></textarea>
                </div>

                <div class="photo-upload-section">
                    <button type="button" class="photo-upload-btn" onclick="document.getElementById('photoUpload').click()">
                        📷 Adicionar Foto
                    </button>
                    <input type="file" id="photoUpload" accept="image/*" onchange="handlePhotoUpload(event)">
                    
                    <div id="photoPreview" class="photo-preview" style="display: none;">
                        <img id="previewImage" src="" alt="Preview">
                        <br>
                        <button type="button" class="remove-photo-btn" onclick="removePhoto()">❌ Remover Foto</button>
                    </div>
                </div>

                <button id="createPostBtn" class="submit-btn" onclick="createPost()">
                    ✨ Destacar Pessoa
                </button>
            </div>
        </div>

        <div id="perfilTab" class="tab-content">
            <div class="follow-stats">
                <div class="follow-stat" onclick="showFollowingModal()">
                    <div class="follow-number" id="followingCount">0</div>
                    <div class="follow-label">Seguindo</div>
                </div>
                <div class="follow-stat" onclick="showFollowersModal()">
                    <div class="follow-number" id="followersCount">0</div>
                    <div class="follow-label">Seguidores</div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="userPostsCount">0</div>
                    <div class="stat-label">Posts Criados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userReactionsReceived">0</div>
                    <div class="stat-label">Reações Recebidas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userPeopleHighlighted">0</div>
                    <div class="stat-label">Pessoas Destacadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userFollowersCount">0</div>
                    <div class="stat-label">Seguidores</div>
                </div>
            </div>

            <div class="evolution-chart">
                <h3 class="chart-title">🏆 Suas Conquistas</h3>
                <div style="margin-bottom: 1rem;">
                    <strong>Primeiro Destaque</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="firstHighlightProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="firstHighlightText">0/1</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Multiplicador de Holofotes</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="multiplierProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="multiplierText">0/10</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Inspirador da Comunidade</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="inspirerProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="inspirerText">0/50</div>
                </div>
            </div>
        </div>

        <div id="impactoTab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalReachCount">0</div>
                    <div class="stat-label">Pessoas Alcançadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalReactionsCount">0</div>
                    <div class="stat-label">Total de Reações</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="averageReactionsCount">0</div>
                    <div class="stat-label">Média por Post</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="impactGrowthCount">+0%</div>
                    <div class="stat-label">Crescimento</div>
                </div>
            </div>

            <div class="evolution-chart">
                <h3 class="chart-title">📈 Sua Evolução</h3>
                <div style="margin-bottom: 1rem;">
                    <strong>Meta Mensal: 20 Destaques</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="monthlyGoalProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="monthlyGoalText">0/20</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Engajamento da Comunidade</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="engagementProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="engagementText">0%</div>
                </div>
            </div>

            <div class="evolution-chart">
                <h3 class="chart-title">💡 Dica Personalizada</h3>
                <p id="personalizedTip" style="color: #666; line-height: 1.6;">
                    Continue destacando pessoas especiais! Cada post seu inspira outros a reconhecer o valor das pessoas ao seu redor.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://dwcmrbrhyuflhtymbhll.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3Y21yYnJoeXVmbGh0eW1iaGxsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzNDU0NDgsImV4cCI6MjA3MTkyMTQ0OH0.55BtZc5dcwTlF7TXNMuoD0Sa6bUO2WkB-r1itj5t2tw';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentUser = null;
        let posts = [];
        let notifications = [];
        let following = [];
        let followers = [];
        let selectedPhotoFile = null;
        let selectedHighlightType = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('🚀 HoloSpot v8 iniciando...');
                
                // Check if user is already logged in
                console.log('🔍 Verificando sessão...');
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    console.error('❌ Erro ao verificar sessão:', error);
                    showLogin();
                    return;
                }
                
                if (session) {
                    console.log('✅ Usuário logado encontrado:', session.user.email);
                    currentUser = session.user;
                    showApp();
                    
                    try {
                        console.log('📊 Carregando dados do usuário...');
                        await loadUserData();
                    } catch (error) {
                        console.error('❌ Erro ao carregar dados do usuário:', error);
                    }
                    
                    try {
                        console.log('📝 Carregando posts...');
                        await loadPosts();
                    } catch (error) {
                        console.error('❌ Erro ao carregar posts:', error);
                    }
                    
                    try {
                        console.log('🔔 Carregando notificações...');
                        await loadNotifications();
                    } catch (error) {
                        console.error('❌ Erro ao carregar notificações:', error);
                    }
                    
                    try {
                        console.log('📈 Atualizando estatísticas...');
                        updateStats();
                    } catch (error) {
                        console.error('❌ Erro ao atualizar estatísticas:', error);
                    }
                } else {
                    console.log('👤 Nenhum usuário logado, mostrando tela de login');
                    showLogin();
                }

                // Setup event listeners
                console.log('🎯 Configurando event listeners...');
                setupEventListeners();
                console.log('✅ HoloSpot v8 carregado com sucesso!');
                
            } catch (error) {
                console.error('💥 ERRO CRÍTICO na inicialização:', error);
                alert('Erro ao carregar o HoloSpot. Recarregue a página.');
            }
        });

        function setupEventListeners() {
            try {
                console.log('🎯 Configurando event listeners...');
                
                // Login button
                const loginBtn = document.getElementById('loginBtn');
                if (loginBtn) {
                    loginBtn.addEventListener('click', handleLogin);
                    console.log('✅ Login button listener configurado');
                } else {
                    console.warn('⚠️ Login button não encontrado');
                }
                
                // Logout button
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', handleLogout);
                    console.log('✅ Logout button listener configurado');
                } else {
                    console.warn('⚠️ Logout button não encontrado');
                }
                
                // Tab navigation
                const navTabs = document.querySelectorAll('.nav-tab');
                if (navTabs.length > 0) {
                    navTabs.forEach(tab => {
                        tab.addEventListener('click', () => switchTab(tab.dataset.tab));
                    });
                    console.log(`✅ ${navTabs.length} tab listeners configurados`);
                } else {
                    console.warn('⚠️ Nav tabs não encontradas');
                }

                // Highlight type selection
                const highlightTypes = document.querySelectorAll('.highlight-type');
                if (highlightTypes.length > 0) {
                    highlightTypes.forEach(type => {
                        type.addEventListener('click', () => selectHighlightType(type.dataset.type));
                    });
                    console.log(`✅ ${highlightTypes.length} highlight type listeners configurados`);
                } else {
                    console.warn('⚠️ Highlight types não encontrados');
                }

                // Notifications
                const notificationsBtn = document.getElementById('notificationsBtn');
                if (notificationsBtn) {
                    notificationsBtn.addEventListener('click', toggleNotifications);
                    console.log('✅ Notifications button listener configurado');
                } else {
                    console.warn('⚠️ Notifications button não encontrado');
                }
                
                // Close notifications when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.notifications')) {
                        const dropdown = document.getElementById('notificationDropdown');
                        if (dropdown) {
                            dropdown.style.display = 'none';
                        }
                    }
                });
                console.log('✅ Outside click listener configurado');
                
            } catch (error) {
                console.error('❌ Erro ao configurar event listeners:', error);
            }
        }

        function selectHighlightType(type) {
            // Remove previous selection
            document.querySelectorAll('.highlight-type').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Add selection to clicked type
            document.querySelector(`[data-type="${type}"]`).classList.add('selected');
            selectedHighlightType = type;
        }

        async function handleLogin() {
            try {
                console.log('🔐 Iniciando login...');
                trackEvent('login_attempt');
                
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: 'https://holospot.vercel.app'
                    }
                });
                
                if (error) {
                    console.error('❌ Erro no login:', error);
                    alert('Erro no login: ' + error.message);
                }
            } catch (error) {
                console.error('❌ Erro no login:', error);
                alert('Erro no login: ' + error.message);
            }
        }

        async function handleLogout() {
            try {
                console.log('🚪 Fazendo logout...');
                await supabase.auth.signOut();
                currentUser = null;
                showLogin();
                console.log('✅ Logout realizado com sucesso');
            } catch (error) {
                console.error('❌ Erro no logout:', error);
            }
        }

        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appContainer').classList.remove('active');
        }

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            
            // Update user info in header
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.user_metadata.name || currentUser.email || 'Usuário';
                document.getElementById('userAvatar').src = currentUser.user_metadata.avatar_url || '';
                console.log('✅ Usuário logado:', currentUser.email);
            }
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            console.log('📱 Aba alterada para:', tabName);
        }

        async function loadUserData() {
            try {
                console.log('📊 Carregando dados do usuário...');
                
                // Modo offline temporário - sem queries do Supabase
                console.warn('⚠️ Usando modo offline para seguir/seguidores');
                
                // Dados de exemplo para demonstração
                following = [
                    { following_id: 'user-1' },
                    { following_id: 'user-2' }
                ];
                followers = [
                    { follower_id: 'user-3' },
                    { follower_id: 'user-4' },
                    { follower_id: 'user-5' }
                ];
                
                console.log(`✅ Dados carregados (modo offline): ${following.length} seguindo, ${followers.length} seguidores`);
                
                // Atualizar contadores na interface
                updateFollowCounts();
                console.log('✅ Dados do usuário carregados e atualizados');
                
            } catch (error) {
                console.error('❌ Erro crítico ao carregar dados do usuário:', error);
                // Fallback final
                following = [];
                followers = [];
                updateFollowCounts();
            }
        }

        function updateFollowCounts() {
            const followingCountEl = document.getElementById('followingCount');
            const followersCountEl = document.getElementById('followersCount');
            
            if (followingCountEl) followingCountEl.textContent = following.length;
            if (followersCountEl) followersCountEl.textContent = followers.length;
            
            console.log(`📊 Contadores atualizados: ${following.length} seguindo, ${followers.length} seguidores`);
        }

        async function loadPosts() {
            try {
                console.log('📝 Carregando posts...');
                
                // Modo offline temporário - sem queries do Supabase
                console.warn('⚠️ Usando modo offline para posts');
                
                // Posts de exemplo para demonstração
                posts = [
                    {
                        id: 'example-1',
                        user_id: 'user-1',
                        celebrated_person_name: 'Maria Silva',
                        content: 'Uma professora incrível que sempre acredita no potencial de cada aluno. Sua dedicação transforma vidas todos os dias.',
                        type: 'gratitude',
                        photo_url: null,
                        created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2 horas atrás
                        user_data: {
                            name: 'Ana Santos',
                            avatar_url: 'https://ui-avatars.com/api/?name=Ana+Santos&background=667eea&color=fff'
                        },
                        reactions: [
                            { id: 'r1', user_id: 'user-3', type: 'touched', created_at: new Date().toISOString() },
                            { id: 'r2', user_id: 'user-4', type: 'grateful', created_at: new Date().toISOString() }
                        ]
                    },
                    {
                        id: 'example-2',
                        user_id: 'user-2',
                        celebrated_person_name: 'João Oliveira',
                        content: 'Meu colega de trabalho que sempre está disposto a ajudar. Sua generosidade e conhecimento fazem toda a diferença na equipe.',
                        type: 'admiration',
                        photo_url: null,
                        created_at: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(), // 5 horas atrás
                        user_data: {
                            name: 'Carlos Mendes',
                            avatar_url: 'https://ui-avatars.com/api/?name=Carlos+Mendes&background=764ba2&color=fff'
                        },
                        reactions: [
                            { id: 'r3', user_id: 'user-5', type: 'inspired', created_at: new Date().toISOString() }
                        ]
                    },
                    {
                        id: 'example-3',
                        user_id: 'user-3',
                        celebrated_person_name: 'Dr. Pedro Costa',
                        content: 'Um médico dedicado que salvou a vida da minha mãe. Sua competência e humanidade são inspiradoras.',
                        type: 'gratitude',
                        photo_url: null,
                        created_at: new Date(Date.now() - 8 * 60 * 60 * 1000).toISOString(), // 8 horas atrás
                        user_data: {
                            name: 'Lucia Ferreira',
                            avatar_url: 'https://ui-avatars.com/api/?name=Lucia+Ferreira&background=f093fb&color=fff'
                        },
                        reactions: [
                            { id: 'r4', user_id: 'user-1', type: 'touched', created_at: new Date().toISOString() },
                            { id: 'r5', user_id: 'user-2', type: 'grateful', created_at: new Date().toISOString() },
                            { id: 'r6', user_id: 'user-4', type: 'inspired', created_at: new Date().toISOString() }
                        ]
                    }
                ];
                
                console.log(`✅ ${posts.length} posts carregados (modo offline)`);
                
                renderPosts();
                console.log('✅ Posts processados e renderizados');
                
            } catch (error) {
                console.error('❌ Erro crítico ao carregar posts:', error);
                posts = [];
                renderPosts();
            }
        }

        async function loadPostsReactions() {
            try {
                console.log('💖 Carregando reações dos posts...');
                
                if (posts.length === 0) {
                    console.log('⚠️ Nenhum post para carregar reações');
                    return;
                }
                
                const postIds = posts.map(p => p.id);
                
                try {
                    const { data: reactionsData, error } = await supabase
                        .from('reactions')
                        .select('*')
                        .in('post_id', postIds);
                    
                    if (error) {
                        console.error('❌ Erro na query de reações:', error);
                        throw error;
                    }
                    
                    console.log(`✅ ${reactionsData?.length || 0} reações carregadas do banco`);
                    
                    // Distribuir reações para os posts correspondentes
                    posts.forEach(post => {
                        post.reactions = reactionsData?.filter(r => r.post_id === post.id) || [];
                    });
                    
                } catch (reactionsError) {
                    console.warn('⚠️ Falha na query de reações, usando reações de exemplo:', reactionsError.message);
                    
                    // Fallback: Reações de exemplo
                    posts.forEach((post, index) => {
                        if (index === 0) {
                            post.reactions = [
                                { id: 'r1', user_id: 'user-3', type: 'touched', created_at: new Date().toISOString() },
                                { id: 'r2', user_id: 'user-4', type: 'grateful', created_at: new Date().toISOString() }
                            ];
                        } else if (index === 1) {
                            post.reactions = [
                                { id: 'r3', user_id: 'user-5', type: 'inspired', created_at: new Date().toISOString() }
                            ];
                        } else {
                            post.reactions = [];
                        }
                    });
                }
                
                console.log('✅ Reações distribuídas para os posts');
                
            } catch (error) {
                console.error('❌ Erro crítico ao carregar reações:', error);
                // Garantir que todos os posts tenham array de reações
                posts.forEach(post => {
                    if (!post.reactions) {
                        post.reactions = [];
                    }
                });
            }
        }

        async function processPostsUserData() {
            console.log('👥 Processando dados de usuários...');
            
            for (let post of posts) {
                try {
                    if (post.user_id === currentUser.id) {
                        // Usuário atual
                        post.user_data = {
                            name: currentUser.user_metadata?.name || currentUser.email || 'Você',
                            avatar_url: currentUser.user_metadata?.avatar_url || ''
                        };
                    } else {
                        // Outros usuários - gerar dados consistentes baseados no ID
                        const names = ['Ana Silva', 'João Santos', 'Maria Oliveira', 'Pedro Costa', 'Carla Mendes', 'Lucas Ferreira'];
                        const nameIndex = post.user_id.charCodeAt(0) % names.length;
                        const userName = names[nameIndex];
                        
                        post.user_data = {
                            name: userName,
                            avatar_url: `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=667eea&color=fff`
                        };
                    }
                    
                    // Inicializar array de reações se não existir
                    if (!post.reactions) {
                        post.reactions = [];
                    }
                    
                } catch (userError) {
                    console.warn('⚠️ Erro ao processar usuário do post:', userError);
                    post.user_data = {
                        name: 'Usuário',
                        avatar_url: 'https://ui-avatars.com/api/?name=Usuario&background=ccc&color=333'
                    };
                    post.reactions = [];
                }
            }
            
            console.log('✅ Dados de usuários processados');
        }

        function renderPosts() {
            const container = document.getElementById('postsContainer');
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="post">
                        <h3 style="text-align: center; color: #764ba2; margin-bottom: 1rem;">🎭 Bem-vindo ao HoloSpot!</h3>
                        <p style="text-align: center; color: #666;">
                            Seja o primeiro a destacar alguém especial! Vá para a aba "✨ Destacar" e comece a espalhar reconhecimento.
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = posts.map(post => {
                const isFollowing = following.some(f => f.following_id === post.user_id);
                const userReactions = post.reactions.filter(r => r.user_id === currentUser.id);
                
                const typeEmojis = {
                    'gratidao': '🙏', 'gratitude': '🙏',
                    'memoria': '💭', 'memory': '💭',
                    'conquista': '🏆', 'achievement': '🏆',
                    'inspiracao': '✨', 'inspiration': '✨',
                    'apoio': '🤝', 'support': '🤝',
                    'admiracao': '🌟', 'admiration': '🌟'
                };

                const typeNames = {
                    'gratidao': 'Gratidão', 'gratitude': 'Gratidão',
                    'memoria': 'Memória', 'memory': 'Memória',
                    'conquista': 'Conquista', 'achievement': 'Conquista',
                    'inspiracao': 'Inspiração', 'inspiration': 'Inspiração',
                    'apoio': 'Apoio', 'support': 'Apoio',
                    'admiracao': 'Admiração', 'admiration': 'Admiração'
                };
                
                return `
                    <div class="post">
                        <div class="post-header">
                            <img class="post-avatar" src="${post.user_data?.avatar_url || ''}" alt="Avatar">
                            <div class="post-author">
                                <div class="post-author-name">${post.user_data?.name || 'Usuário'}</div>
                                <div class="post-time">${formatDate(post.created_at)}</div>
                            </div>
                            ${post.user_id !== currentUser.id ? `
                                <button class="follow-btn ${isFollowing ? 'following' : ''}" onclick="toggleFollow('${post.user_id}')">
                                    ${isFollowing ? '✓ Seguindo' : '+ Seguir'}
                                </button>
                            ` : ''}
                        </div>
                        
                        <div class="post-content">
                            <div class="post-person">🎭 ${post.celebrated_person_name || post.person_name}</div>
                            ${post.type || post.highlight_type ? `
                                <div class="post-type">
                                    ${typeEmojis[post.type || post.highlight_type] || '✨'} ${typeNames[post.type || post.highlight_type] || 'Destaque'}
                                </div>
                            ` : ''}
                            <div class="post-story">${post.content || post.story}</div>
                            ${post.photo_url ? `<img class="post-image" src="${post.photo_url}" alt="Foto do post">` : ''}
                        </div>
                        
                        <div class="post-reactions">
                            <button class="reaction-btn ${userReactions.some(r => r.type === 'touched') ? 'active' : ''}" 
                                    onclick="toggleReaction('${post.id}', 'touched')">
                                ❤️ ${post.reactions.filter(r => r.type === 'touched').length}
                            </button>
                            <button class="reaction-btn ${userReactions.some(r => r.type === 'grateful') ? 'active' : ''}" 
                                    onclick="toggleReaction('${post.id}', 'grateful')">
                                🙏 ${post.reactions.filter(r => r.type === 'grateful').length}
                            </button>
                            <button class="reaction-btn ${userReactions.some(r => r.type === 'inspired') ? 'active' : ''}" 
                                    onclick="toggleReaction('${post.id}', 'inspired')">
                                ✨ ${post.reactions.filter(r => r.type === 'inspired').length}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function toggleFollow(userId) {
            try {
                console.log(`👥 Tentando ${following.some(f => f.following_id === userId) ? 'desseguir' : 'seguir'} usuário:`, userId);
                const isFollowing = following.some(f => f.following_id === userId);
                
                if (isFollowing) {
                    // Unfollow
                    try {
                        await supabase
                            .from('follows')
                            .delete()
                            .eq('follower_id', currentUser.id)
                            .eq('following_id', userId);
                        console.log('✅ Unfollow realizado no banco');
                    } catch (unfollowError) {
                        console.warn('⚠️ Erro ao desseguir no banco, atualizando apenas localmente:', unfollowError.message);
                    }
                    
                    following = following.filter(f => f.following_id !== userId);
                    console.log('✅ Usuário removido da lista local de seguindo');
                } else {
                    // Follow
                    try {
                        await supabase
                            .from('follows')
                            .insert({
                                follower_id: currentUser.id,
                                following_id: userId
                            });
                        console.log('✅ Follow realizado no banco');
                    } catch (followError) {
                        console.warn('⚠️ Erro ao seguir no banco, atualizando apenas localmente:', followError.message);
                    }
                    
                    following.push({ following_id: userId });
                    console.log('✅ Usuário adicionado à lista local de seguindo');
                    
                    // Tentar criar notificação
                    try {
                        await createNotification(userId, 'follow', `${currentUser.user_metadata.name || currentUser.email} começou a te seguir!`);
                        console.log('✅ Notificação de follow criada');
                    } catch (notifError) {
                        console.warn('⚠️ Erro ao criar notificação de follow:', notifError.message);
                    }
                }
                
                // Sempre atualizar contadores e interface
                updateFollowCounts();
                renderPosts();
                console.log('✅ Interface atualizada após follow/unfollow');
                
            } catch (error) {
                console.error('❌ Erro crítico ao seguir/desseguir:', error);
                alert('Erro ao seguir/desseguir usuário. Tente novamente.');
            }
        }

        async function toggleReaction(postId, type) {
            try {
                console.log(`💖 Tentando ${type} no post:`, postId);
                const post = posts.find(p => p.id === postId);
                
                if (!post) {
                    console.error('❌ Post não encontrado:', postId);
                    return;
                }
                
                const existingReaction = post.reactions.find(r => r.user_id === currentUser.id && r.type === type);
                
                if (existingReaction) {
                    // Remove reaction
                    try {
                        await supabase
                            .from('reactions')
                            .delete()
                            .eq('id', existingReaction.id);
                        console.log('✅ Reação removida do banco');
                    } catch (deleteError) {
                        console.warn('⚠️ Erro ao remover reação do banco, removendo apenas localmente:', deleteError.message);
                    }
                    
                    post.reactions = post.reactions.filter(r => r.id !== existingReaction.id);
                    console.log('✅ Reação removida localmente');
                } else {
                    // Add reaction
                    let newReaction = null;
                    
                    try {
                        const { data, error } = await supabase
                            .from('reactions')
                            .insert({
                                post_id: postId,
                                user_id: currentUser.id,
                                type: type
                            })
                            .select()
                            .single();
                        
                        if (error) throw error;
                        
                        newReaction = data;
                        console.log('✅ Reação adicionada no banco');
                    } catch (insertError) {
                        console.warn('⚠️ Erro ao adicionar reação no banco, adicionando apenas localmente:', insertError.message);
                        
                        // Fallback: criar reação local
                        newReaction = {
                            id: `local-${Date.now()}`,
                            post_id: postId,
                            user_id: currentUser.id,
                            type: type,
                            created_at: new Date().toISOString()
                        };
                    }
                    
                    if (newReaction) {
                        post.reactions.push(newReaction);
                        console.log('✅ Reação adicionada localmente');
                        
                        // Tentar criar notificação para o autor do post
                        if (post.user_id !== currentUser.id) {
                            try {
                                const reactionEmoji = { touched: '❤️', grateful: '🙏', inspired: '✨' }[type];
                                const userName = currentUser.user_metadata?.name || currentUser.email || 'Alguém';
                                const personName = post.celebrated_person_name || post.person_name || 'uma pessoa especial';
                                
                                await createNotification(
                                    post.user_id, 
                                    'reaction', 
                                    `${userName} reagiu ${reactionEmoji} ao seu post sobre ${personName}`
                                );
                                console.log('✅ Notificação de reação criada');
                            } catch (notifError) {
                                console.warn('⚠️ Erro ao criar notificação de reação:', notifError.message);
                            }
                        }
                    }
                }
                
                // Sempre re-renderizar posts e atualizar estatísticas
                renderPosts();
                updateStats();
                console.log('✅ Interface atualizada após reação');
                
            } catch (error) {
                console.error('❌ Erro crítico ao reagir:', error);
                alert('Erro ao reagir ao post. Tente novamente.');
            }
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Por favor, selecione apenas arquivos de imagem.');
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('A imagem deve ter no máximo 5MB.');
                return;
            }
            
            selectedPhotoFile = file;
            
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('photoPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
            
            console.log('📷 Foto selecionada:', file.name, file.size, 'bytes');
        }

        function removePhoto() {
            selectedPhotoFile = null;
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('photoUpload').value = '';
        }

        async function uploadPhoto(file) {
            try {
                console.log('📸 Iniciando upload da foto:', file.name);
                
                // Verificar se o bucket existe e está configurado
                try {
                    const { data: buckets, error: bucketsError } = await supabase.storage.listBuckets();
                    if (bucketsError) throw bucketsError;
                    
                    const photoBucket = buckets.find(b => b.name === 'photos');
                    if (!photoBucket) {
                        console.warn('⚠️ Bucket "photos" não encontrado');
                        throw new Error('Bucket de fotos não configurado');
                    }
                    console.log('✅ Bucket "photos" encontrado');
                } catch (bucketError) {
                    console.warn('⚠️ Erro ao verificar bucket:', bucketError.message);
                    throw new Error('Erro na configuração do storage');
                }
                
                // Gerar nome único para o arquivo
                const fileExt = file.name.split('.').pop();
                const fileName = `${currentUser.id}_${Date.now()}.${fileExt}`;
                console.log('📝 Nome do arquivo:', fileName);
                
                // Fazer upload do arquivo
                const { data, error } = await supabase.storage
                    .from('photos')
                    .upload(fileName, file, {
                        cacheControl: '3600',
                        upsert: false
                    });
                
                if (error) {
                    console.error('❌ Erro no upload:', error);
                    throw error;
                }
                
                console.log('✅ Upload realizado com sucesso:', data.path);
                
                // Obter URL pública
                const { data: urlData } = supabase.storage
                    .from('photos')
                    .getPublicUrl(fileName);
                
                const publicUrl = urlData.publicUrl;
                console.log('✅ URL pública gerada:', publicUrl);
                
                return publicUrl;
                
            } catch (error) {
                console.error('❌ Erro crítico no upload:', error);
                throw new Error(`Falha no upload: ${error.message}`);
            }
        }

        async function createPost() {
            const personName = document.getElementById('personName').value.trim();
            const storyText = document.getElementById('storyText').value.trim();
            
            if (!personName || !storyText) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            if (!selectedHighlightType) {
                alert('Por favor, selecione um tipo de destaque.');
                return;
            }

            // Map Portuguese types to English for database constraint
            const typeMapping = {
                'gratidao': 'gratitude',
                'memoria': 'memory',
                'conquista': 'achievement',
                'inspiracao': 'inspiration',
                'apoio': 'support',
                'admiracao': 'admiration'
            };
            
            const mappedType = typeMapping[selectedHighlightType] || selectedHighlightType;
            
            const createBtn = document.getElementById('createPostBtn');
            createBtn.disabled = true;
            createBtn.textContent = 'Criando...';
            
            try {
                let photoUrl = null;
                
                // Upload photo if selected
                if (selectedPhotoFile) {
                    try {
                        console.log('📸 Tentando upload da foto...');
                        createBtn.textContent = 'Fazendo upload da foto...';
                        photoUrl = await uploadPhoto(selectedPhotoFile);
                        console.log('✅ Upload da foto concluído:', photoUrl);
                    } catch (uploadError) {
                        console.error('❌ Erro no upload da foto:', uploadError);
                        
                        // Perguntar ao usuário se quer continuar sem foto
                        const continueWithoutPhoto = confirm(
                            `Erro ao fazer upload da foto: ${uploadError.message}\n\n` +
                            'Deseja continuar criando o post sem a foto?'
                        );
                        
                        if (!continueWithoutPhoto) {
                            createBtn.disabled = false;
                            createBtn.textContent = '✨ Destacar Pessoa';
                            return;
                        }
                        
                        console.log('⚠️ Continuando sem foto por escolha do usuário');
                        photoUrl = null;
                    }
                }
                
                // Create post
                createBtn.textContent = 'Criando post...';
                console.log('📝 Criando post no banco de dados...');
                
                try {
                    const { data, error } = await supabase
                        .from('posts')
                        .insert({
                            user_id: currentUser.id,
                            celebrated_person_name: personName,
                            content: storyText,
                            photo_url: photoUrl,
                            type: mappedType
                        })
                        .select()
                        .single();
                    
                    if (error) {
                        console.error('❌ Erro ao criar post no banco:', error);
                        throw error;
                    }
                    
                    console.log('✅ Post criado no banco com sucesso');
                    
                    // Add user data and reactions array to the new post
                    data.user_data = {
                        name: currentUser.user_metadata?.name || currentUser.email || 'Usuário',
                        avatar_url: currentUser.user_metadata?.avatar_url || ''
                    };
                    data.reactions = [];
                    
                    // Add to posts array at the beginning
                    posts.unshift(data);
                    console.log('✅ Post adicionado à lista local');
                    
                } catch (postError) {
                    console.error('❌ Erro ao criar post:', postError);
                    
                    // Fallback: criar post apenas localmente
                    console.warn('⚠️ Criando post apenas localmente como fallback');
                    const localPost = {
                        id: `local-${Date.now()}`,
                        user_id: currentUser.id,
                        celebrated_person_name: personName,
                        content: storyText,
                        photo_url: photoUrl,
                        type: mappedType,
                        created_at: new Date().toISOString(),
                        user_data: {
                            name: currentUser.user_metadata?.name || currentUser.email || 'Usuário',
                            avatar_url: currentUser.user_metadata?.avatar_url || ''
                        },
                        reactions: []
                    };
                    
                    posts.unshift(localPost);
                    console.log('✅ Post local criado como fallback');
                    
                    alert('Post criado localmente. Pode haver problemas de sincronização com o servidor.');
                }
                
                // Clear form
                document.getElementById('personName').value = '';
                document.getElementById('storyText').value = '';
                removePhoto();
                
                // Clear highlight type selection
                document.querySelectorAll('.highlight-type').forEach(el => {
                    el.classList.remove('selected');
                });
                selectedHighlightType = null;
                
                // Switch to home tab and re-render
                switchTab('inicio');
                renderPosts();
                updateStats();
                
                trackEvent('post_created', { 
                    person_name: personName, 
                    has_photo: !!photoUrl,
                    story_length: storyText.length,
                    highlight_type: selectedHighlightType
                });
                
                alert('✨ Post criado com sucesso!');
                
            } catch (error) {
                console.error('❌ Erro ao criar post:', error);
                alert('Erro ao criar post: ' + error.message);
            } finally {
                createBtn.disabled = false;
                createBtn.textContent = '✨ Destacar Pessoa';
            }
        }

        async function createNotification(userId, type, message) {
            try {
                await supabase
                    .from('notifications')
                    .insert({
                        user_id: userId,
                        type: type,
                        message: message,
                        from_user_id: currentUser.id
                    });
            } catch (error) {
                console.error('❌ Erro ao criar notificação:', error);
            }
        }

        async function loadNotifications() {
            try {
                console.log('🔔 Carregando notificações...');
                
                // Tentar carregar notificações reais do Supabase
                try {
                    console.log('🔍 Fazendo query de notificações no Supabase...');
                    const { data, error } = await supabase
                        .from('notifications')
                        .select('*')
                        .eq('user_id', currentUser.id)
                        .order('created_at', { ascending: false })
                        .limit(20);
                    
                    if (error) {
                        console.error('❌ Erro na query de notificações:', error);
                        throw error;
                    }
                    
                    console.log(`✅ ${data?.length || 0} notificações carregadas do banco`);
                    notifications = data || [];
                    
                } catch (queryError) {
                    console.warn('⚠️ Falha na query de notificações, usando notificações de exemplo:', queryError.message);
                    
                    // Fallback: Notificações de exemplo se query falhar
                    notifications = [
                        {
                            id: 'notif-1',
                            user_id: currentUser.id,
                            type: 'reaction',
                            message: 'Ana Silva reagiu ❤️ ao seu post sobre Maria Silva',
                            from_user_id: 'user-1',
                            read: false,
                            created_at: new Date(Date.now() - 30 * 60 * 1000).toISOString() // 30 min atrás
                        },
                        {
                            id: 'notif-2',
                            user_id: currentUser.id,
                            type: 'follow',
                            message: 'João Santos começou a te seguir!',
                            from_user_id: 'user-2',
                            read: false,
                            created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString() // 2 horas atrás
                        },
                        {
                            id: 'notif-3',
                            user_id: currentUser.id,
                            type: 'reaction',
                            message: 'Carlos Mendes reagiu 🙏 ao seu post sobre João Oliveira',
                            from_user_id: 'user-3',
                            read: true,
                            created_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString() // 1 dia atrás
                        }
                    ];
                }
                
                updateNotificationBadge();
                renderNotifications();
                console.log('✅ Notificações processadas e renderizadas');
                
            } catch (error) {
                console.error('❌ Erro crítico ao carregar notificações:', error);
                // Fallback final
                notifications = [];
                updateNotificationBadge();
                renderNotifications();
            }
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function renderNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            
            if (notifications.length === 0) {
                dropdown.innerHTML = `
                    <div class="notification-item">
                        <strong>Nenhuma notificação</strong><br>
                        <small>Você receberá notificações quando alguém interagir com seus posts</small>
                    </div>
                `;
                return;
            }
            
            dropdown.innerHTML = notifications.map(notification => `
                <div class="notification-item ${!notification.read ? 'unread' : ''}" 
                     onclick="markNotificationAsRead('${notification.id}')">
                    <strong>${notification.message}</strong><br>
                    <small>${formatDate(notification.created_at)}</small>
                </div>
            `).join('');
        }

        async function markNotificationAsRead(notificationId) {
            try {
                // Tentar atualizar no banco
                try {
                    await supabase
                        .from('notifications')
                        .update({ read: true })
                        .eq('id', notificationId);
                    console.log('✅ Notificação marcada como lida no banco');
                } catch (updateError) {
                    console.warn('⚠️ Erro ao atualizar no banco, marcando apenas localmente:', updateError.message);
                }
                
                // Sempre atualizar estado local
                const notification = notifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.read = true;
                    console.log('✅ Notificação marcada como lida localmente');
                }
                
                updateNotificationBadge();
                renderNotifications();
                
            } catch (error) {
                console.error('❌ Erro ao marcar notificação como lida:', error);
            }
        }

        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function updateStats() {
            const userPosts = posts.filter(p => p.user_id === currentUser.id);
            const userTotalReactions = userPosts.reduce((sum, post) => sum + post.reactions.length, 0);
            const uniquePeople = new Set(userPosts.map(p => p.celebrated_person_name || p.person_name)).size;
            
            // Profile tab stats
            document.getElementById('userPostsCount').textContent = userPosts.length;
            document.getElementById('userReactionsReceived').textContent = userTotalReactions;
            document.getElementById('userPeopleHighlighted').textContent = uniquePeople;
            document.getElementById('userFollowersCount').textContent = followers.length;
            
            // Impact tab stats
            const totalReactions = posts.reduce((sum, post) => sum + post.reactions.length, 0);
            const estimatedReach = totalReactions * 3 + userPosts.length * 5; // More realistic calculation
            document.getElementById('totalReachCount').textContent = estimatedReach;
            document.getElementById('totalReactionsCount').textContent = totalReactions;
            document.getElementById('averageReactionsCount').textContent = posts.length > 0 ? Math.round(totalReactions / posts.length) : 0;
            
            // Growth calculation (mock for now)
            const growthPercentage = Math.min(userPosts.length * 10, 200);
            document.getElementById('impactGrowthCount').textContent = `+${growthPercentage}%`;
            
            // Update progress bars
            updateProgressBars(userPosts.length, totalReactions);
            
            // Update personalized tip
            updatePersonalizedTip(userPosts.length, totalReactions);
        }

        function updateProgressBars(postsCount, reactionsCount) {
            // First highlight achievement
            const firstProgress = Math.min(postsCount / 1 * 100, 100);
            document.getElementById('firstHighlightProgress').style.width = firstProgress + '%';
            document.getElementById('firstHighlightText').textContent = `${Math.min(postsCount, 1)}/1`;
            
            // Multiplier achievement
            const multiplierProgress = Math.min(postsCount / 10 * 100, 100);
            document.getElementById('multiplierProgress').style.width = multiplierProgress + '%';
            document.getElementById('multiplierText').textContent = `${Math.min(postsCount, 10)}/10`;
            
            // Inspirer achievement
            const inspirerProgress = Math.min(reactionsCount / 50 * 100, 100);
            document.getElementById('inspirerProgress').style.width = inspirerProgress + '%';
            document.getElementById('inspirerText').textContent = `${Math.min(reactionsCount, 50)}/50`;
            
            // Monthly goal
            const monthlyProgress = Math.min(postsCount / 20 * 100, 100);
            document.getElementById('monthlyGoalProgress').style.width = monthlyProgress + '%';
            document.getElementById('monthlyGoalText').textContent = `${Math.min(postsCount, 20)}/20`;
            
            // Engagement
            const engagementRate = postsCount > 0 ? Math.min((reactionsCount / postsCount) * 10, 100) : 0;
            document.getElementById('engagementProgress').style.width = engagementRate + '%';
            document.getElementById('engagementText').textContent = Math.round(engagementRate) + '%';
        }

        function updatePersonalizedTip(postsCount, reactionsCount) {
            let tip = '';
            
            if (postsCount === 0) {
                tip = 'Comece destacando alguém especial! Cada pessoa merece reconhecimento pelo que faz de bom.';
            } else if (postsCount < 5) {
                tip = 'Você está no caminho certo! Continue destacando pessoas que fazem a diferença na sua vida.';
            } else if (reactionsCount < postsCount * 2) {
                tip = 'Seus posts estão inspirando pessoas! Tente adicionar fotos para aumentar o engajamento.';
            } else {
                tip = 'Incrível! Você está criando uma onda de positividade. Continue espalhando reconhecimento!';
            }
            
            document.getElementById('personalizedTip').textContent = tip;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 1) {
                return 'Agora mesmo';
            } else if (diffInMinutes < 60) {
                return `Há ${diffInMinutes} minuto${diffInMinutes > 1 ? 's' : ''}`;
            } else if (diffInMinutes < 1440) { // 24 hours
                const hours = Math.floor(diffInMinutes / 60);
                return `Há ${hours} hora${hours > 1 ? 's' : ''}`;
            } else {
                const days = Math.floor(diffInMinutes / 1440);
                return `Há ${days} dia${days > 1 ? 's' : ''}`;
            }
        }

        function showFollowingModal() {
            const followingList = following.map(f => {
                // Gerar nome consistente baseado no ID
                const names = ['Ana Silva', 'João Santos', 'Maria Oliveira', 'Pedro Costa', 'Carla Mendes', 'Lucas Ferreira'];
                const nameIndex = f.following_id.charCodeAt(0) % names.length;
                const userName = names[nameIndex];
                
                return `
                    <div class="follow-item">
                        <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=667eea&color=fff" 
                             alt="Avatar" style="width: 32px; height: 32px; border-radius: 50%; margin-right: 10px;">
                        <span>${userName}</span>
                    </div>
                `;
            }).join('');
            
            const modal = `
                <div class="modal-overlay" onclick="closeModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <h3>Seguindo (${following.length})</h3>
                        <div class="follow-list">
                            ${followingList || '<p>Você ainda não segue ninguém.</p>'}
                        </div>
                        <button onclick="closeModal()" style="margin-top: 15px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">Fechar</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        function showFollowersModal() {
            const followersList = followers.map(f => {
                // Gerar nome consistente baseado no ID
                const names = ['Ana Silva', 'João Santos', 'Maria Oliveira', 'Pedro Costa', 'Carla Mendes', 'Lucas Ferreira'];
                const nameIndex = f.follower_id.charCodeAt(0) % names.length;
                const userName = names[nameIndex];
                
                return `
                    <div class="follow-item">
                        <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=764ba2&color=fff" 
                             alt="Avatar" style="width: 32px; height: 32px; border-radius: 50%; margin-right: 10px;">
                        <span>${userName}</span>
                    </div>
                `;
            }).join('');
            
            const modal = `
                <div class="modal-overlay" onclick="closeModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <h3>Seguidores (${followers.length})</h3>
                        <div class="follow-list">
                            ${followersList || '<p>Você ainda não tem seguidores.</p>'}
                        </div>
                        <button onclick="closeModal()" style="margin-top: 15px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">Fechar</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        // Listen for auth state changes
        supabase.auth.onAuthStateChange(async (event, session) => {
            if (event === 'SIGNED_IN') {
                currentUser = session.user;
                showApp();
                await loadUserData();
                await loadPosts();
                await loadNotifications();
                updateStats();
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                showLogin();
            }
        });

        console.log('✅ HoloSpot v8 carregado com sucesso!');
    </script>
</body>
</html>

