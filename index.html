<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HoloSpot - Colocando os holofotes nos outros</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HKK75JRY5W"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-HKK75JRY5W');
        
        function trackEvent(eventName, parameters = {}) {
            gtag('event', eventName, parameters);
            console.log('üìä Event tracked:', eventName, parameters);
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem 0.5rem 2rem;
            box-shadow: none;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: none;
            border-radius: 0;
            margin-bottom: -10px;
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .header-content {
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0;
        }

        /* Layout mobile - duas linhas */
        @media (max-width: 768px) {
            /* Reorganiza elementos para mobile */
            .header-content {
                display: grid;
                grid-template-areas: 
                    "logo notifications"
                    "user-section logout";
                grid-template-columns: 1fr auto;
                gap: 1rem;
                align-items: center;
            }

            .logo {
                grid-area: logo;
                grid-column: 1 / -1;
                justify-self: center !important;
                align-self: center;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                justify-content: center;
            }

            .notifications {
                grid-area: notifications;
                justify-self: end;
            }

            .user-section {
                grid-area: user-section;
                justify-self: start;
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }

            .logout-btn {
                grid-area: logout;
                justify-self: end;
            }

            .header-actions {
                display: contents;
            }
        }

        /* Layout desktop - uma linha */
        @media (min-width: 769px) {
            .header-top {
                display: contents;
            }

            .header-bottom {
                display: contents;
            }

            .user-section {
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }

            /* Aproxima abas do header apenas no desktop */
            .nav-tabs {
                top: 67px !important;
            }

            /* Reorganiza header para desktop */
            .header-content {
                display: grid;
                grid-template-columns: 1fr auto 1fr;
                grid-template-areas: none !important;
                align-items: center !important;
                gap: 2rem;
                height: auto;
            }

            /* User info na esquerda */
            .user-section {
                grid-column: 1;
                grid-area: unset !important;
                justify-self: start !important;
                align-self: center;
                order: 1;
            }

            /* Logo no centro */
            .logo {
                grid-column: 2;
                grid-area: unset !important;
                justify-self: center !important;
                align-self: center;
                order: 2;
            }

            /* Notifica√ß√µes e bot√£o sair na direita */
            .header-actions {
                grid-column: 3;
                grid-area: unset !important;
                justify-self: end;
                align-self: center;
                display: flex;
                align-items: center;
                gap: 1rem;
                order: 3;
            }

            .notifications {
                order: 1;
            }

            .logout-btn {
                order: 2;
            }
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo span {
            background: linear-gradient(135deg, #667eea, #764ba2) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            color: transparent !important;
            display: inline-block;
            margin-left: 0.5rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFF 30%, transparent 70%);
            border-radius: 50%;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            background: conic-gradient(from 0deg, transparent 0deg, rgba(255, 215, 0, 0.3) 45deg, transparent 90deg, rgba(255, 215, 0, 0.3) 135deg, transparent 180deg, rgba(255, 215, 0, 0.3) 225deg, transparent 270deg, rgba(255, 215, 0, 0.3) 315deg, transparent 360deg);
            border-radius: 50%;
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notifications {
            position: relative;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            background: rgba(118, 75, 162, 0.1);
            transition: all 0.3s ease;
        }

        .notifications:hover {
            background: rgba(118, 75, 162, 0.2);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .notification-item:hover {
            background: #f8f9fa;
        }

        .notification-item.unread {
            background: rgba(118, 75, 162, 0.05);
            border-left: 3px solid #764ba2;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0;
        }

        .user-name {
            font-weight: 600;
            color: #333;
            line-height: 1.2;
            margin: 0;
            padding: 0;
        }

        .user-username {
            font-size: 0.85rem;
            color: #666;
            margin-top: 3px;
            margin-bottom: 0;
            padding: 0;
            line-height: 1.1;
        }

        .logout-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #ff3742;
            transform: translateY(-1px);
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .login-logo .logo-icon {
            width: 60px;
            height: 60px;
        }

        .login-title {
            font-size: 2rem;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .google-login-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            transition: all 0.3s ease;
        }

        .google-login-btn:hover {
            border-color: #4285f4;
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.2);
            transform: translateY(-2px);
        }

        /* Main App */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem 2rem 2rem;
            display: none;
        }

        .app-container.active {
            display: block;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 0;
            padding: 0.5rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow-x: auto;
            margin-top: -10px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
            position: sticky;
            top: 122px;
            z-index: 98;
        }

        .nav-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            min-width: 120px;
            text-indent: -2px;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .nav-tab:not(.active):hover {
            background: rgba(118, 75, 162, 0.1);
            transform: translateY(-1px);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Posts */
        .posts-container {
            display: grid;
            gap: 1.5rem;
        }

        .post {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .post:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .post-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .post-author {
            flex: 1;
        }

        .post-author-name {
            font-weight: 600;
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.2;
        }

        .post-author-meta {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 3px;
        }

        .post-author-username {
            font-size: 0.85rem;
            color: #666;
            margin: 0;
            padding: 0;
            line-height: 1.1;
        }

        .post-time-separator {
            color: #999;
            font-size: 0.8rem;
        }

        .post-time {
            color: #666;
            font-size: 0.75rem;
        }

        .follow-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .follow-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .follow-btn.following {
            background: #28a745;
        }

        .post-content {
            margin-bottom: 1rem;
        }

        .post-person {
            font-weight: 600;
            color: #764ba2;
            margin-bottom: 0.5rem;
        }

        .post-type {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .post-story {
            color: #555;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .post-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .post-reactions {
            display: flex;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .reaction-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .reaction-btn:hover {
            background: rgba(118, 75, 162, 0.1);
            transform: translateY(-1px);
        }

        .reaction-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* Feedback Section */
        .feedback-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
        }

        .feedback-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .feedback-btn.feedback-given {
            background: #28a745;
            cursor: not-allowed;
        }

        .feedback-btn.feedback-given:hover {
            transform: none;
            box-shadow: none;
        }

        /* Create Post Form */
        .create-post-form {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            resize: vertical;
        }

        .form-input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(118, 75, 162, 0.1);
        }

        .highlight-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .highlight-type {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .highlight-type:hover {
            border-color: #764ba2;
            transform: translateY(-2px);
        }

        .highlight-type.selected {
            border-color: #764ba2;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .highlight-type-emoji {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .highlight-type-name {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .highlight-type-desc {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .photo-upload-section {
            margin-bottom: 1.5rem;
        }

        .photo-upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .photo-upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .photo-preview {
            margin-top: 1rem;
            text-align: center;
        }

        .photo-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            object-fit: cover;
        }

        .remove-photo-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Profile & Impact Tabs */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .evolution-chart {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .progress-bar {
            background: #f0f0f0;
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            color: #666;
            text-align: right;
        }

        /* Following/Followers */
        .follow-stats {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .follow-stat {
            text-align: center;
            cursor: pointer;
            padding: 1rem;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .follow-stat:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .follow-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .follow-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                backdrop-filter: blur(0px);
            }
            to {
                opacity: 1;
                backdrop-filter: blur(4px);
            }
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 450px;
            width: 90%;
            max-height: 70vh;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease-out;
            overflow: hidden;
            position: relative;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px) scale(0.9);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 24px;
            max-height: calc(70vh - 80px);
            overflow-y: auto;
        }

        .follow-list {
            margin: 0;
        }

        .follow-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
            color: #374151;
            transition: all 0.2s ease;
        }

        .follow-item:last-child {
            border-bottom: none;
        }

        .follow-item:hover {
            background: #f9fafb;
            margin: 0 -24px;
            padding: 12px 24px;
            border-radius: 8px;
        }

        .follow-item img {
            margin-right: 12px;
            border: 2px solid #e5e7eb;
            transition: border-color 0.2s ease;
        }

        .follow-item:hover img {
            border-color: #667eea;
        }

        .follow-item span {
            font-weight: 500;
            font-size: 0.95rem;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Feedback Modal */
        .feedback-modal {
            background: white;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease-out;
            overflow: hidden;
            position: relative;
        }

        .feedback-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .feedback-modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .feedback-modal-body {
            padding: 24px;
        }

        .feedback-modal-body p {
            margin: 0 0 1rem 0;
            color: #555;
        }

        .feedback-modal-footer {
            padding: 16px 24px;
            background: #f8f9fa;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            border-top: 1px solid #e9ecef;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: none;
            outline: none;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .app-container {
                padding: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .nav-tab {
                min-width: auto;
                flex: 1;
                padding: 0.5rem 0;
                font-size: 0.75rem;
                font-weight: 500;
                text-align: center !important;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .follow-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .highlight-types {
                grid-template-columns: 1fr;
            }
        }

        /* Hidden file input */
        #photoUpload {
            display: none;
        }

        /* Sistema de Men√ß√µes */
        .textarea-container {
            position: relative;
        }

        .mentions-autocomplete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 4px;
        }

        .mention-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid #f3f4f6;
        }

        .mention-item:last-child {
            border-bottom: none;
        }

        .mention-item:hover,
        .mention-item.selected {
            background-color: #f3f4f6;
        }

        .mention-item img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 12px;
            border: 2px solid #e5e7eb;
        }

        .mention-info {
            flex: 1;
        }

        .mention-name {
            font-weight: 500;
            color: #374151;
            font-size: 0.95rem;
        }

        .mention-username {
            color: #6b7280;
            font-size: 0.85rem;
            margin-top: 2px;
        }

        /* Destaque das men√ß√µes nos posts */
        .mention-highlight {
            color: #667eea;
            font-weight: 500;
            text-decoration: none;
        }

        .mention-highlight:hover {
            text-decoration: underline;
        }

        /* Bot√£o de Impacto */
        .impact-button-container {
            margin: 2rem 0;
            text-align: center;
        }

        .impact-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .impact-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        /* Modal de Impacto */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-container {
            background: white;
            border-radius: 20px;
            max-width: 90vw;
            max-height: 90vh;
            width: 600px;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .modal-body {
            padding: 2rem;
        }

        @media (max-width: 768px) {
            .modal-container {
                width: 95vw;
                max-height: 85vh;
            }
            
            .modal-header {
                padding: 1rem 1.5rem;
            }
            
            .modal-body {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <div class="logo-icon"></div>
                <div class="login-title">HoloSpot</div>
            </div>
            <p class="login-subtitle">Colocando os holofotes nos outros</p>
            <button id="loginBtn" class="google-login-btn">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Entrar com Google
            </button>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <!-- User section (esquerda no desktop) -->
            <div class="user-section">
                <img id="userAvatar" class="user-avatar" src="" alt="Avatar">
                <div class="user-info">
                    <div id="userName" class="user-name">Carregando...</div>
                    <div id="userUsername" class="user-username">@carregando</div>
                </div>
            </div>

            <!-- Logo (centro no desktop) -->
            <div class="logo">
                <div class="logo-icon"></div>
                <span>HoloSpot</span>
            </div>

            <!-- Actions (direita no desktop) -->
            <div class="header-actions">
                <div class="notifications" id="notificationsBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                    </svg>
                    <div class="notification-badge" id="notificationBadge" style="display: none;">0</div>
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-item">
                            <div class="notification-text">Voc√™ tem novas men√ß√µes!</div>
                            <div class="notification-time">h√° 2 minutos</div>
                        </div>
                    </div>
                </div>
                <button id="logoutBtn" class="logout-btn">Sair</button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-tabs">
        <div class="nav-tab active" data-tab="inicio">üè† In√≠cio</div>
        <div class="nav-tab" data-tab="destacar">‚ú® Destacar</div>
        <div class="nav-tab" data-tab="perfil">üë§ Perfil</div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="app-container">

        <!-- Tab Contents -->
        <div id="inicioTab" class="tab-content active">
            <div id="postsContainer" class="posts-container">
                <!-- Posts will be loaded here -->
            </div>
        </div>

        <div id="destacarTab" class="tab-content">
            <div class="create-post-form">
                <h2 style="margin-bottom: 1.5rem; color: #764ba2;">‚ú® Destacar Algu√©m</h2>
                
                <div class="form-group">
                    <label class="form-label">Nome da pessoa</label>
                    <div class="textarea-container">
                        <input type="text" id="personName" class="form-input" placeholder="Digite o nome ou use @ para mencionar algu√©m...">
                        <div id="mentionsAutocomplete" class="mentions-autocomplete" style="display: none;"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Que tipo de destaque √© esse?</label>
                    <div class="highlight-types">
                        <div class="highlight-type" data-type="gratidao">
                            <div class="highlight-type-emoji">üôè</div>
                            <div class="highlight-type-name">Gratid√£o</div>
                            <div class="highlight-type-desc">Agradecer por algo</div>
                        </div>
                        <div class="highlight-type" data-type="memoria">
                            <div class="highlight-type-emoji">üí≠</div>
                            <div class="highlight-type-name">Mem√≥ria</div>
                            <div class="highlight-type-desc">Lembrar momentos especiais</div>
                        </div>
                        <div class="highlight-type" data-type="conquista">
                            <div class="highlight-type-emoji">üèÜ</div>
                            <div class="highlight-type-name">Conquista</div>
                            <div class="highlight-type-desc">Celebrar vit√≥rias</div>
                        </div>
                        <div class="highlight-type" data-type="inspiracao">
                            <div class="highlight-type-emoji">‚ú®</div>
                            <div class="highlight-type-name">Inspira√ß√£o</div>
                            <div class="highlight-type-desc">Reconhecer exemplo</div>
                        </div>
                        <div class="highlight-type" data-type="apoio">
                            <div class="highlight-type-emoji">ü§ù</div>
                            <div class="highlight-type-name">Apoio</div>
                            <div class="highlight-type-desc">Valorizar suporte</div>
                        </div>
                        <div class="highlight-type" data-type="admiracao">
                            <div class="highlight-type-emoji">üåü</div>
                            <div class="highlight-type-name">Admira√ß√£o</div>
                            <div class="highlight-type-desc">Expressar respeito</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Conte sua hist√≥ria</label>
                    <textarea id="storyText" class="form-input" rows="4" placeholder="Por que essa pessoa merece destaque? O que ela fez de especial?"></textarea>
                </div>

                <div class="photo-upload-section">
                    <button type="button" class="photo-upload-btn" onclick="document.getElementById('photoUpload').click()">
                        üì∑ Adicionar Foto
                    </button>
                    <input type="file" id="photoUpload" accept="image/*" onchange="handlePhotoUpload(event)">
                    
                    <div id="photoPreview" class="photo-preview" style="display: none;">
                        <img id="previewImage" src="" alt="Preview">
                        <br>
                        <button type="button" class="remove-photo-btn" onclick="removePhoto()">‚ùå Remover Foto</button>
                    </div>
                </div>

                <button id="createPostBtn" class="submit-btn" onclick="createPost()">
                    ‚ú® Destacar Pessoa
                </button>
            </div>
        </div>

        <div id="perfilTab" class="tab-content">
            <div class="follow-stats">
                <div class="follow-stat" onclick="showFollowingModal()">
                    <div class="follow-number" id="followingCount">0</div>
                    <div class="follow-label">Seguindo</div>
                </div>
                <div class="follow-stat" onclick="showFollowersModal()">
                    <div class="follow-number" id="followersCount">0</div>
                    <div class="follow-label">Seguidores</div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card" id="postsCreatedCard" style="cursor: pointer; transition: transform 0.2s ease;" onclick="openPostsModal()">
                    <div class="stat-number" id="userPostsCount">0</div>
                    <div class="stat-label">Posts Criados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userReactionsReceived">0</div>
                    <div class="stat-label">Rea√ß√µes Recebidas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userPeopleHighlighted">0</div>
                    <div class="stat-label">Pessoas Destacadas</div>
                </div>
            </div>

            <!-- Bot√£o para abrir modal de Impacto -->
            <div class="impact-button-container">
                <button id="impactBtn" class="impact-btn" onclick="openImpactModal()">üìä Ver Impacto Detalhado</button>
            </div>

            <div class="evolution-chart">
                <h3 class="chart-title">üèÜ Suas Conquistas</h3>
                <div style="margin-bottom: 1rem;">
                    <strong>Primeiro Destaque</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="firstHighlightProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="firstHighlightText">0/1</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Inspirador da Comunidade</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="inspirerProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="inspirerText">0/50</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Meta Mensal: 20 Destaques</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="monthlyGoalProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="monthlyGoalText">0/20</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Multiplicador de Holofotes</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="multiplierProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="multiplierText">1.0x</div>
                </div>
            </div>

            <!-- Bot√£o para abrir modal de Feedbacks -->
            <div class="impact-button-container">
                </div>

            <!-- Dica Personalizada movida do modal de impacto -->
            <div class="evolution-chart">
                <h3 class="chart-title">üí° Dica Personalizada</h3>
                <p id="personalizedTip" style="color: #666; line-height: 1.6;">
                    Continue destacando pessoas especiais! Cada post seu inspira outros a reconhecer o valor das pessoas ao seu redor.
                </p>
            </div>
        </div>
    </div>
    <!-- Modal de Impacto -->
    <div id="impactModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2>üìä Seu Impacto</h2>
                <button class="close-btn" onclick="closeImpactModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="modalTotalReachCount">0</div>
                        <div class="stat-label">Pessoas Alcan√ßadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="modalTotalReactionsCount">0</div>
                        <div class="stat-label">Total de Rea√ß√µes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="modalAverageReactionsCount">0</div>
                        <div class="stat-label">M√©dia por Post</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="modalImpactGrowthCount">+0%</div>
                        <div class="stat-label">Crescimento</div>
                    </div>
                </div>

                <div class="evolution-chart">
                    <h3 class="chart-title">üìà Sua Evolu√ß√£o</h3>
                    <div style="margin-bottom: 1rem;">
                        <strong>Engajamento da Comunidade</strong>
                        <div class="progress-bar">
                            <div class="progress-fill" id="modalEngagementProgress" style="width: 0%"></div>
                        </div>
                        <div class="progress-text" id="modalEngagementText">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Feedbacks Recebidos -->
    <div id="feedbacksModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2>üîÑ Feedbacks Recebidos</h2>
                <button class="close-btn" onclick="closeFeedbacksModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modalFeedbacksContent" style="max-height: 400px; overflow-y: auto;">
                    <!-- Feedbacks ser√£o carregados aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Posts Criados -->
    <div id="postsModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2>üìù Seus Posts</h2>
                <button class="close-btn" onclick="closePostsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modalPostsContent" style="max-height: 400px; overflow-y: auto;">
                    <!-- Posts ser√£o carregados aqui -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://dwcmrbrhyuflhtymbhll.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3Y21yYnJoeXVmbGh0eW1iaGxsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzNDU0NDgsImV4cCI6MjA3MTkyMTQ0OH0.55BtZc5dcwTlF7TXNMuoD0Sa6bUO2WkB-r1itj5t2tw';
        const SUPABASE_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3Y21yYnJoeXVmbGh0eW1iaGxsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NjM0NTQ0OCwiZXhwIjoyMDcxOTIxNDQ4fQ.BiSk7GLtjIE0oU3H9MaxvR2xNlNyOeXcM-zkiL6qtlU';
        
        // Usar service role key para bypass RLS
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY);
        
        // Fun√ß√£o para timeout agressivo
        function withTimeout(promise, timeoutMs = 10000) {
            return Promise.race([
                promise,
                new Promise((_, reject) => 
                    setTimeout(() => reject(new Error(`Timeout ap√≥s ${timeoutMs}ms`)), timeoutMs)
                )
            ]);
        }
        
        let currentUser = null;
        let posts = [];
        let notifications = [];
        let following = [];
        let followers = [];
        let selectedPhotoFile = null;
        let selectedHighlightType = null;

        // Sistema de Men√ß√µes
        let mentionUsers = [];
        let currentMentionQuery = '';
        let selectedMentionIndex = -1;
        let mentionStartPos = -1;

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('üöÄ HoloSpot v8 iniciando...');
                
                // Check if user is already logged in
                console.log('üîç Verificando sess√£o...');
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    console.error('‚ùå Erro ao verificar sess√£o:', error);
                    showLogin();
                    return;
                }
                
                if (session) {
                    console.log('‚úÖ Usu√°rio logado encontrado:', session.user.email);
                    currentUser = session.user;
                    showApp();
                    
                    try {
                        console.log('üìä Carregando dados do usu√°rio...');
                        await loadUserData();
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
                    }
                    
                    try {
                        console.log('üìù Carregando posts...');
                        await loadPosts();
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar posts:', error);
                    }
                    
                    try {
                        console.log('üîî Carregando notifica√ß√µes...');
                        await loadNotifications();
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar notifica√ß√µes:', error);
                    }
                    
                    try {
                        console.log('üìà Atualizando estat√≠sticas...');
                        updateStats();
                    } catch (error) {
                        console.error('‚ùå Erro ao atualizar estat√≠sticas:', error);
                    }
                } else {
                    console.log('üë§ Nenhum usu√°rio logado, mostrando tela de login');
                    showLogin();
                }

                // Setup event listeners
                console.log('üéØ Configurando event listeners...');
                setupEventListeners();
                console.log('‚úÖ HoloSpot v8 carregado com sucesso!');
                
            } catch (error) {
                console.error('üí• ERRO CR√çTICO na inicializa√ß√£o:', error);
                alert('Erro ao carregar o HoloSpot. Recarregue a p√°gina.');
            }
        });

        function setupEventListeners() {
            try {
                console.log('üéØ Configurando event listeners...');
                
                // Login button
                const loginBtn = document.getElementById('loginBtn');
                if (loginBtn) {
                    loginBtn.addEventListener('click', handleLogin);
                    console.log('‚úÖ Login button listener configurado');
                } else {
                    console.warn('‚ö†Ô∏è Login button n√£o encontrado');
                }
                
                // Logout button
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', handleLogout);
                    console.log('‚úÖ Logout button listener configurado');
                } else {
                    console.warn('‚ö†Ô∏è Logout button n√£o encontrado');
                }
                
                // Tab navigation
                const navTabs = document.querySelectorAll('.nav-tab');
                if (navTabs.length > 0) {
                    navTabs.forEach(tab => {
                        tab.addEventListener('click', () => switchTab(tab.dataset.tab));
                    });
                    console.log(`‚úÖ ${navTabs.length} tab listeners configurados`);
                } else {
                    console.warn('‚ö†Ô∏è Nav tabs n√£o encontradas');
                }

                // Highlight type selection
                const highlightTypes = document.querySelectorAll('.highlight-type');
                if (highlightTypes.length > 0) {
                    highlightTypes.forEach(type => {
                        type.addEventListener('click', () => selectHighlightType(type.dataset.type));
                    });
                    console.log(`‚úÖ ${highlightTypes.length} highlight type listeners configurados`);
                } else {
                    console.warn('‚ö†Ô∏è Highlight types n√£o encontrados');
                }

                // Notifications
                const notificationsBtn = document.getElementById('notificationsBtn');
                if (notificationsBtn) {
                    notificationsBtn.addEventListener('click', toggleNotifications);
                    console.log('‚úÖ Notifications button listener configurado');
                } else {
                    console.warn('‚ö†Ô∏è Notifications button n√£o encontrado');
                }
                
                // Close notifications when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.notifications')) {
                        const dropdown = document.getElementById('notificationDropdown');
                        if (dropdown) {
                            dropdown.style.display = 'none';
                        }
                    }
                });
                console.log('‚úÖ Outside click listener configurado');

                // Event listeners j√° configurados via onclick no HTML
                console.log('‚úÖ Event listeners configurados via onclick no HTML');
                
            } catch (error) {
                console.error('‚ùå Erro ao configurar event listeners:', error);
            }
        }

        function selectHighlightType(type) {
            // Remove previous selection
            document.querySelectorAll('.highlight-type').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Add selection to clicked type
            document.querySelector(`[data-type="${type}"]`).classList.add('selected');
            selectedHighlightType = type;
        }

        async function handleLogin() {
            try {
                console.log('üîê Iniciando login...');
                trackEvent('login_attempt');
                
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: 'https://holospot.vercel.app'
                    }
                });
                
                if (error) {
                    console.error('‚ùå Erro no login:', error);
                    alert('Erro no login: ' + error.message);
                }
            } catch (error) {
                console.error('‚ùå Erro no login:', error);
                alert('Erro no login: ' + error.message);
            }
        }

        async function handleLogout() {
            try {
                console.log('üö™ Fazendo logout...');
                await supabase.auth.signOut();
                currentUser = null;
                showLogin();
                console.log('‚úÖ Logout realizado com sucesso');
            } catch (error) {
                console.error('‚ùå Erro no logout:', error);
            }
        }

        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appContainer').classList.remove('active');
        }

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            
            // Update user info in header
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.user_metadata.name || currentUser.email || 'Usu√°rio';
                document.getElementById('userUsername').textContent = '@' + (currentUser.email?.split('@')[0] || 'usuario');
                document.getElementById('userAvatar').src = currentUser.user_metadata.avatar_url || '';
                console.log('‚úÖ Usu√°rio logado:', currentUser.email);
            }
            
            // Inicializar sistema de men√ß√µes
            loadMentionUsers().then(() => {
                setupMentionsSystem();
            });
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            console.log('üì± Aba alterada para:', tabName);
        }

        // Fun√ß√µes do Modal de Impacto
        function openImpactModal() {
            const modal = document.getElementById('impactModal');
            if (modal) {
                modal.style.display = 'flex';
                loadImpactDataInModal();
            }
        }

        function closeImpactModal() {
            const modal = document.getElementById('impactModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        async function loadImpactDataInModal() {
            try {
                console.log('üìä Carregando dados de impacto no modal...');
                
                // Carregar posts do usu√°rio
                const { data: userPosts, error: postsError } = await supabase
                    .from('posts')
                    .select('*')
                    .eq('user_id', currentUser.id);

                if (postsError) throw postsError;

                // Calcular estat√≠sticas
                const totalPosts = userPosts.length;
                const totalReactions = userPosts.reduce((sum, post) => sum + (post.reactions_count || 0), 0);
                const averageReactions = totalPosts > 0 ? Math.round(totalReactions / totalPosts) : 0;
                const totalReach = totalPosts * 10; // Estimativa simples

                // Atualizar elementos do modal
                document.getElementById('modalTotalReachCount').textContent = totalReach;
                document.getElementById('modalTotalReactionsCount').textContent = totalReactions;
                document.getElementById('modalAverageReactionsCount').textContent = averageReactions;
                document.getElementById('modalImpactGrowthCount').textContent = '+15%';

                // Atualizar barra de progresso de engajamento
                const engagementProgress = Math.min((averageReactions / 10) * 100, 100);
                document.getElementById('modalEngagementProgress').style.width = `${engagementProgress}%`;
                document.getElementById('modalEngagementText').textContent = `${Math.round(engagementProgress)}%`;

                console.log('‚úÖ Dados de impacto carregados no modal');
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados de impacto:', error);
            }
        }

        // Fun√ß√µes do Modal de Feedbacks
        function openFeedbacksModal() {
            const modal = document.getElementById('feedbacksModal');
            if (modal) {
                modal.style.display = 'flex';
                loadFeedbacksInModal();
            }
        }

        function closeFeedbacksModal() {
            const modal = document.getElementById('feedbacksModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        async function loadFeedbacksInModal() {
            try {
                console.log('üîÑ Carregando feedbacks no modal...');
                
                // Primeiro, vamos tentar buscar feedbacks com diferentes estruturas poss√≠veis
                let feedbacks = [];
                let error = null;
                
                // Tentar primeira estrutura (to_user_id)
                try {
                    const { data: feedbacksData, error: feedbacksError } = await supabase
                        .from('feedbacks')
                        .select(`
                            *,
                            from_user:from_user_id(name, username, avatar_url),
                            post:post_id(content, highlight_type)
                        `)
                        .eq('to_user_id', currentUser.id)
                        .order('created_at', { ascending: false });
                    
                    if (!feedbacksError && feedbacksData) {
                        feedbacks = feedbacksData;
                    } else {
                        throw feedbacksError;
                    }
                } catch (firstError) {
                    console.log('Tentando estrutura alternativa...');
                    
                    // Tentar segunda estrutura (mentioned_user_id)
                    try {
                        const { data: feedbacksData2, error: feedbacksError2 } = await supabase
                            .from('feedbacks')
                            .select(`
                                *,
                                author:author_id(name, username, avatar_url),
                                post:post_id(content, highlight_type)
                            `)
                            .eq('mentioned_user_id', currentUser.id)
                            .order('created_at', { ascending: false });
                        
                        if (!feedbacksError2 && feedbacksData2) {
                            feedbacks = feedbacksData2;
                        } else {
                            throw feedbacksError2;
                        }
                    } catch (secondError) {
                        console.log('Tentando buscar todos os feedbacks...');
                        
                        // Tentar buscar todos e filtrar
                        const { data: allFeedbacks, error: allError } = await supabase
                            .from('feedbacks')
                            .select('*')
                            .order('created_at', { ascending: false });
                        
                        if (allError) throw allError;
                        
                        // Filtrar feedbacks relacionados ao usu√°rio atual
                        feedbacks = allFeedbacks.filter(feedback => 
                            feedback.to_user_id === currentUser.id || 
                            feedback.mentioned_user_id === currentUser.id ||
                            feedback.user_id === currentUser.id
                        );
                    }
                }

                const feedbacksContainer = document.getElementById('modalFeedbacksContent');
                
                if (!feedbacks || feedbacks.length === 0) {
                    feedbacksContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <p>üì≠ Nenhum feedback recebido ainda</p>
                            <p style="font-size: 14px; margin-top: 10px;">Continue destacando pessoas para receber feedbacks!</p>
                            <p style="font-size: 12px; color: #999; margin-top: 10px;">Debug: Estrutura da tabela pode estar diferente</p>
                        </div>
                    `;
                    return;
                }

                console.log('Feedbacks encontrados:', feedbacks);

                const feedbacksHtml = feedbacks.map(feedback => {
                    // Tentar diferentes campos para o remetente
                    const sender = feedback.from_user || feedback.author || {};
                    const senderName = sender.name || feedback.sender_name || 'Usu√°rio';
                    const senderUsername = sender.username || feedback.sender_username || 'usuario';
                    const senderAvatar = sender.avatar_url || '/default-avatar.png';
                    
                    // Tentar diferentes campos para a mensagem
                    const message = feedback.message || feedback.feedback_text || feedback.content || 'Feedback sem conte√∫do';
                    
                    return `
                        <div style="background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #667eea; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <img src="${senderAvatar}" 
                                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                                <div>
                                    <div style="font-weight: 600; color: #333;">${senderName}</div>
                                    <div style="font-size: 12px; color: #666;">@${senderUsername}</div>
                                </div>
                                <div style="margin-left: auto; font-size: 12px; color: #999;">
                                    ${new Date(feedback.created_at).toLocaleDateString('pt-BR')}
                                </div>
                            </div>
                            <div style="color: #555; line-height: 1.5; background: #f8f9fa; padding: 12px; border-radius: 8px;">
                                "${message}"
                            </div>
                        </div>
                    `;
                }).join('');

                feedbacksContainer.innerHTML = feedbacksHtml;
                console.log('‚úÖ Feedbacks carregados no modal:', feedbacks.length);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar feedbacks:', error);
                document.getElementById('modalFeedbacksContent').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <p>‚ùå Erro ao carregar feedbacks</p>
                        <p style="font-size: 14px;">Erro: ${error.message}</p>
                        <p style="font-size: 12px; color: #999;">Verifique a estrutura da tabela feedbacks</p>
                    </div>
                `;
            }
        }

        // Fun√ß√µes do Modal de Posts
        function openPostsModal() {
            const modal = document.getElementById('postsModal');
            if (modal) {
                modal.style.display = 'flex';
                loadPostsInModal();
            }
        }

        function closePostsModal() {
            const modal = document.getElementById('postsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        async function getFeedbacksForAuthorPost(post) {
            // Fun√ß√£o removida - agora s√≥ usamos o modal clic√°vel
            return '';
        }

        async function loadPostsInModal() {
            try {
                console.log('üìù Carregando posts no modal...');
                
                // Recarregar posts do usu√°rio atual para evitar problemas de cache
                const { data: userPosts, error } = await supabase
                    .from('posts')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('‚ùå Erro ao carregar posts do usu√°rio:', error);
                    throw error;
                }
                
                console.log('üìä Posts do usu√°rio encontrados:', userPosts?.length || 0);
                
                const postsContainer = document.getElementById('modalPostsContent');
                
                if (!userPosts || userPosts.length === 0) {
                    postsContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 48px; margin-bottom: 15px;">üìù</div>
                            <p>üìù Nenhum post criado ainda</p>
                            <p style="font-size: 14px; margin-top: 10px;">Comece destacando algu√©m especial!</p>
                        </div>
                    `;
                    return;
                }

                // Recarregar rea√ß√µes para os posts do usu√°rio
                const postIds = userPosts.map(p => p.id);
                let allReactions = [];
                
                if (postIds.length > 0) {
                    try {
                        const { data: reactionsData } = await supabase
                            .from('reactions')
                            .select('*')
                            .in('post_id', postIds);
                        allReactions = reactionsData || [];
                    } catch (reactionError) {
                        console.log('Erro ao carregar rea√ß√µes:', reactionError);
                    }
                }

                // Usar o mesmo c√≥digo do renderPosts do in√≠cio
                const postsHtml = [];
                for (const post of userPosts) {
                    // Adicionar rea√ß√µes ao post
                    post.reactions = allReactions.filter(r => r.post_id === post.id);
                    post.user_data = {
                        name: currentUser.user_metadata?.name || currentUser.email?.split('@')[0] || 'Usu√°rio',
                        email: currentUser.email,
                        avatar_url: currentUser.user_metadata?.avatar_url || ''
                    };
                    
                    const typeEmojis = {
                        'gratidao': 'üôè', 'gratitude': 'üôè',
                        'memoria': 'üí≠', 'memory': 'üí≠',
                        'conquista': 'üèÜ', 'achievement': 'üèÜ',
                        'inspiracao': '‚ú®', 'inspiration': '‚ú®',
                        'apoio': 'ü§ù', 'support': 'ü§ù',
                        'admiracao': 'üåü', 'admiration': 'üåü'
                    };

                    const typeNames = {
                        'gratidao': 'Gratid√£o', 'gratitude': 'Gratid√£o',
                        'memoria': 'Mem√≥ria', 'memory': 'Mem√≥ria',
                        'conquista': 'Conquista', 'achievement': 'Conquista',
                        'inspiracao': 'Inspira√ß√£o', 'inspiration': 'Inspira√ß√£o',
                        'apoio': 'Apoio', 'support': 'Apoio',
                        'admiracao': 'Admira√ß√£o', 'admiration': 'Admira√ß√£o'
                    };
                    
                    // Contar feedbacks para este post
                    let feedbacksCount = 0;
                    try {
                        const { data: feedbacksData } = await supabase
                            .from('feedbacks')
                            .select('id')
                            .eq('post_id', post.id)
                            .eq('author_id', currentUser.id);
                        feedbacksCount = feedbacksData ? feedbacksData.length : 0;
                    } catch (error) {
                        console.log('Erro ao contar feedbacks:', error);
                    }
                    
                    // Obter feedbacks recebidos para posts do pr√≥prio usu√°rio
                    const feedbacksSection = await getFeedbacksForAuthorPost(post);
                    
                    const postHtml = `
                        <div class="post">
                            <div class="post-header">
                                <img class="post-avatar" src="${post.user_data?.avatar_url || ''}" alt="Avatar">
                                <div class="post-author">
                                    <div class="post-author-name">${post.user_data?.name || 'Usu√°rio'}</div>
                                    <div class="post-author-meta">
                                        <span class="post-author-username">@${post.user_data?.email?.split('@')[0] || 'usuario'}</span>
                                        <span class="post-time-separator">‚Ä¢</span>
                                        <span class="post-time">${formatDateShort(post.created_at)}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="post-content">
                                <div class="post-person">Holofotes para: ${post.celebrated_person_name || post.person_name}</div>
                                ${post.type || post.highlight_type ? `
                                    <div class="post-type">
                                        ${typeEmojis[post.type || post.highlight_type] || '‚ú®'} ${typeNames[post.type || post.highlight_type] || 'Destaque'}
                                    </div>
                                ` : ''}
                                <div class="post-story">${post.content || post.story}</div>
                                ${post.photo_url ? `<img class="post-image" src="${post.photo_url}" alt="Foto do post">` : ''}
                            </div>
                            
                            <div class="post-reactions">
                                <span class="reaction-display" style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: #f5f5f5; border-radius: 20px; color: #666; font-size: 14px;">
                                    ‚ù§Ô∏è ${post.reactions.filter(r => r.type === 'touched').length}
                                </span>
                                <span class="reaction-display" style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: #f5f5f5; border-radius: 20px; color: #666; font-size: 14px;">
                                    üôè ${post.reactions.filter(r => r.type === 'grateful').length}
                                </span>
                                <span class="reaction-display" style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: #f5f5f5; border-radius: 20px; color: #666; font-size: 14px;">
                                    ‚ú® ${post.reactions.filter(r => r.type === 'inspired').length}
                                </span>
                                <span class="feedback-display" ${feedbacksCount > 0 ? `onclick="openPostFeedbackModal('${post.id}')" style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: linear-gradient(135deg, #ff9800, #f57c00); color: white; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: 600; transition: transform 0.2s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"` : `style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: #ccc; color: #666; border-radius: 20px; cursor: not-allowed; font-size: 14px; font-weight: 600;"`}>
                                    üîÑ ${feedbacksCount}
                                </span>
                            </div>
                            
                            ${feedbacksSection}
                        </div>
                    `;
                    
                    postsHtml.push(postHtml);
                }

                postsContainer.innerHTML = postsHtml.join('');
                console.log('‚úÖ Posts carregados no modal');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar posts:', error);
                document.getElementById('modalPostsContent').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <p>‚ùå Erro ao carregar posts</p>
                        <p style="font-size: 14px;">Erro: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Fun√ß√µes do Modal de Feedbacks de Post Espec√≠fico
        function openPostFeedbackModal(postId) {
            console.log('üì¨ Abrindo modal de feedbacks para post:', postId);
            
            // Criar modal
            const modal = document.createElement('div');
            modal.id = 'postFeedbackModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(5px);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 15px;
                    padding: 25px;
                    max-width: 500px;
                    width: 90%;
                    max-height: 70vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    animation: slideIn 0.3s ease;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px;">
                        <h3 style="margin: 0; color: #333; font-size: 18px;">üì¨ Feedbacks Recebidos</h3>
                        <button onclick="closePostFeedbackModal()" style="
                            background: none;
                            border: none;
                            font-size: 24px;
                            cursor: pointer;
                            color: #999;
                            padding: 0;
                            width: 30px;
                            height: 30px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: all 0.2s ease;
                        " onmouseover="this.style.background='#f0f0f0'; this.style.color='#333'" onmouseout="this.style.background='none'; this.style.color='#999'">√ó</button>
                    </div>
                    <div id="postFeedbackContent" style="min-height: 100px;">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 24px; margin-bottom: 10px;">‚è≥</div>
                            <p>Carregando feedbacks...</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Carregar feedbacks
            loadPostFeedbacks(postId);
            
            // Fechar ao clicar fora
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closePostFeedbackModal();
                }
            });
        }

        function closePostFeedbackModal() {
            const modal = document.getElementById('postFeedbackModal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }

        async function loadPostFeedbacks(postId) {
            try {
                console.log('üì¨ Carregando feedbacks para post:', postId);
                
                // Buscar feedbacks sem relacionamento
                const { data: feedbacks, error } = await supabase
                    .from('feedbacks')
                    .select('*')
                    .eq('post_id', postId)
                    .eq('author_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;

                const feedbackContent = document.getElementById('postFeedbackContent');
                
                if (!feedbacks || feedbacks.length === 0) {
                    feedbackContent.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
                            <p style="font-size: 16px; margin-bottom: 5px;">Nenhum feedback recebido</p>
                            <p style="font-size: 14px; color: #999;">Este post ainda n√£o recebeu feedbacks</p>
                        </div>
                    `;
                    return;
                }

                console.log('üìä Feedbacks encontrados:', feedbacks);

                // Buscar dados dos usu√°rios que deram feedback
                const userIds = [...new Set(feedbacks.map(f => f.mentioned_user_id).filter(Boolean))];
                console.log('üë• User IDs para buscar:', userIds);
                
                let users = [];
                
                if (userIds.length > 0) {
                    // Tentar tabela 'profiles' com colunas corretas
                    try {
                        const { data: profilesData, error: profilesError } = await supabase
                            .from('profiles')
                            .select('id, name, email')
                            .in('id', userIds);
                        
                        if (!profilesError && profilesData) {
                            users = profilesData;
                            console.log('‚úÖ Dados encontrados na tabela profiles:', users);
                        } else {
                            console.log('‚ö†Ô∏è Erro na tabela profiles:', profilesError);
                        }
                    } catch (profileError) {
                        console.log('‚ö†Ô∏è Erro ao acessar tabela profiles:', profileError);
                    }
                }

                console.log('üë• Usu√°rios finais encontrados:', users);

                const feedbacksHtml = feedbacks.map(feedback => {
                    // Encontrar dados do usu√°rio
                    const user = users.find(u => u.id === feedback.mentioned_user_id);
                    console.log(`üîç Feedback de ${feedback.mentioned_user_id}:`, user);
                    
                    // Se n√£o encontrou o usu√°rio e √© o pr√≥prio currentUser, usar dados dele
                    let userName, userEmail, username;
                    
                    if (user) {
                        userName = user.name || 'Usu√°rio';
                        userEmail = user.email;
                        username = userEmail?.split('@')[0] || 'usuario';
                    } else if (feedback.mentioned_user_id === currentUser.id) {
                        // √â o pr√≥prio usu√°rio logado
                        userName = currentUser.user_metadata?.name || currentUser.email?.split('@')[0] || 'Voc√™';
                        userEmail = currentUser.email;
                        username = userEmail?.split('@')[0] || 'voce';
                    } else {
                        // Fallback para campos do pr√≥prio feedback
                        userName = feedback.sender_name || feedback.user_name || 'Usu√°rio';
                        userEmail = feedback.sender_email || feedback.user_email;
                        username = userEmail?.split('@')[0] || feedback.sender_username || feedback.username || 'usuario';
                    }
                    
                    const date = new Date(feedback.created_at).toLocaleDateString('pt-BR');
                    const feedbackText = feedback.feedback_text || feedback.message || feedback.content || 'Feedback sem conte√∫do';
                    
                    return `
                        <div style="margin-bottom: 15px; padding: 15px; background: linear-gradient(135deg, #fff3e0, #ffe0b2); border: 1px solid #ff9800; border-radius: 12px; box-shadow: 0 2px 8px rgba(255,152,0,0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div style="color: #e65100; font-weight: bold; font-size: 14px;">
                                    üîÑ ${userName} (@${username})
                                </div>
                                <div style="color: #999; font-size: 12px;">
                                    ${date}
                                </div>
                            </div>
                            <div style="color: #bf360c; line-height: 1.5; font-size: 15px; font-style: italic;">
                                "${feedbackText}"
                            </div>
                        </div>
                    `;
                }).join('');

                feedbackContent.innerHTML = feedbacksHtml;
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar feedbacks do post:', error);
                document.getElementById('postFeedbackContent').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚ùå</div>
                        <p>Erro ao carregar feedbacks</p>
                        <p style="font-size: 14px; color: #999;">${error.message}</p>
                    </div>
                `;
            }
        }

        async function loadUserData() {
            try {
                console.log('üìä Carregando dados do usu√°rio...');
                console.log('üîç Carregando dados de seguir/seguidores reais do Supabase com timeout...');
                
                // Carregar quem eu sigo
                const followingQuery = supabase
                    .from('follows')
                    .select('following_id')
                    .eq('follower_id', currentUser.id);
                
                // Carregar meus seguidores
                const followersQuery = supabase
                    .from('follows')
                    .select('follower_id')
                    .eq('following_id', currentUser.id);
                
                try {
                    const [followingResult, followersResult] = await Promise.all([
                        withTimeout(followingQuery, 2000),
                        withTimeout(followersQuery, 2000)
                    ]);
                    
                    if (followingResult.error) throw followingResult.error;
                    if (followersResult.error) throw followersResult.error;
                    
                    following = followingResult.data || [];
                    followers = followersResult.data || [];
                    
                    console.log(`‚úÖ Dados reais carregados: ${following.length} seguindo, ${followers.length} seguidores`);
                    
                } catch (queryError) {
                    console.warn('‚ö†Ô∏è Erro nas queries, mantendo arrays vazios:', queryError.message);
                    
                    // Manter arrays vazios em caso de erro
                    following = [];
                    followers = [];
                    
                    console.log('‚úÖ Arrays vazios configurados devido ao erro');
                }
                
                // Atualizar contadores na interface
                updateFollowCounts();
                console.log('‚úÖ Dados do usu√°rio carregados e atualizados');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
                
                // Fallback final
                following = [];
                followers = [];
                updateFollowCounts();
                console.log('‚úÖ Fallback aplicado');
            }
        }

        function updateFollowCounts() {
            const followingCountEl = document.getElementById('followingCount');
            const followersCountEl = document.getElementById('followersCount');
            
            if (followingCountEl) followingCountEl.textContent = following.length;
            if (followersCountEl) followersCountEl.textContent = followers.length;
            
            console.log(`üìä Contadores atualizados: ${following.length} seguindo, ${followers.length} seguidores`);
        }

        async function loadPosts() {
            try {
                console.log('üìù Carregando posts...');
                console.log('üîç Carregando posts reais do Supabase com timeout...');
                
                const postsQuery = supabase
                    .from('posts')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                const { data, error } = await withTimeout(postsQuery, 2000);
                
                if (error) {
                    console.error('‚ùå Erro ao carregar posts:', error);
                    throw error;
                }
                
                console.log(`‚úÖ ${data?.length || 0} posts reais carregados do banco`);
                posts = data || [];
                
                // Processar dados de usu√°rios para cada post
                await processPostsUserData();
                
                // Carregar rea√ß√µes para cada post
                await loadPostsReactions();
                
                await renderPosts();
                console.log('‚úÖ Posts processados e renderizados');
                
            } catch (error) {
                console.error('‚ùå Erro cr√≠tico ao carregar posts:', error);
                
                // N√£o usar fallback de posts fict√≠cios - manter array vazio
                console.log('‚ö†Ô∏è Mantendo array de posts vazio devido ao erro');
                posts = [];
                await renderPosts();
                console.log('‚úÖ Interface renderizada sem posts');
            }
        }

        async function loadPostsReactions() {
            try {
                console.log('üíñ Carregando rea√ß√µes dos posts...');
                
                if (posts.length === 0) {
                    console.log('‚ö†Ô∏è Nenhum post para carregar rea√ß√µes');
                    return;
                }
                
                const postIds = posts.map(p => p.id);
                
                try {
                    console.log('üîç Tentando carregar rea√ß√µes reais do Supabase...');
                    
                    // Promise com timeout de 5 segundos
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Timeout na query de rea√ß√µes')), 5000)
                    );
                    
                    const queryPromise = supabase
                        .from('reactions')
                        .select('*')
                        .in('post_id', postIds);
                    
                    const { data: reactionsData, error } = await Promise.race([queryPromise, timeoutPromise]);
                    
                    if (error) {
                        console.error('‚ùå Erro na query de rea√ß√µes:', error);
                        throw error;
                    }
                    
                    console.log(`‚úÖ ${reactionsData?.length || 0} rea√ß√µes reais carregadas do banco`);
                    
                    // Distribuir rea√ß√µes para os posts correspondentes
                    posts.forEach(post => {
                        post.reactions = reactionsData?.filter(r => r.post_id === post.id) || [];
                    });
                    
                } catch (reactionsError) {
                    console.warn('‚ö†Ô∏è Falha na query de rea√ß√µes, usando rea√ß√µes de exemplo:', reactionsError.message);
                    
                    // Fallback: Rea√ß√µes de exemplo
                    posts.forEach((post, index) => {
                        if (index === 0) {
                            post.reactions = [
                                { id: 'r1', user_id: 'user-3', type: 'touched', created_at: new Date().toISOString() },
                                { id: 'r2', user_id: 'user-4', type: 'grateful', created_at: new Date().toISOString() }
                            ];
                        } else if (index === 1) {
                            post.reactions = [
                                { id: 'r3', user_id: 'user-5', type: 'inspired', created_at: new Date().toISOString() }
                            ];
                        } else {
                            post.reactions = [];
                        }
                    });
                }
                
                console.log('‚úÖ Rea√ß√µes distribu√≠das para os posts');
                
            } catch (error) {
                console.error('‚ùå Erro cr√≠tico ao carregar rea√ß√µes:', error);
                // Garantir que todos os posts tenham array de rea√ß√µes
                posts.forEach(post => {
                    if (!post.reactions) {
                        post.reactions = [];
                    }
                });
            }
        }

        async function processPostsUserData() {
            console.log('üë• Processando dados de usu√°rios...');
            
            for (let post of posts) {
                try {
                    if (post.user_id === currentUser.id) {
                        // Usu√°rio atual
                        post.user_data = {
                            name: currentUser.user_metadata?.name || currentUser.email || 'Voc√™',
                            email: currentUser.email,
                            avatar_url: currentUser.user_metadata?.avatar_url || ''
                        };
                    } else {
                        // Outros usu√°rios - buscar dados reais da tabela profiles
                        console.log(`üîç Buscando dados reais do usu√°rio: ${post.user_id}`);
                        
                        try {
                            const userQuery = supabase
                                .from('profiles')
                                .select('name, email, avatar_url')
                                .eq('id', post.user_id)
                                .single();
                            
                            const { data: userData, error: userError } = await withTimeout(userQuery, 1500);
                            
                            if (userData && !userError) {
                                // Dados reais encontrados
                                const realName = userData.name || userData.email || 'Usu√°rio';
                                const realAvatar = userData.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(realName)}&background=667eea&color=fff`;
                                
                                post.user_data = {
                                    name: realName,
                                    email: userData.email,
                                    avatar_url: realAvatar
                                };
                                
                                console.log(`‚úÖ Dados reais encontrados: ${realName}`);
                            } else {
                                throw new Error('Usu√°rio n√£o encontrado na tabela profiles');
                            }
                            
                        } catch (profileError) {
                            console.warn(`‚ö†Ô∏è Erro ao buscar perfil, usando fallback para ${post.user_id}:`, profileError.message);
                            
                            // Fallback com nomes fict√≠cios baseados no ID
                            const names = ['Ana Silva', 'Jo√£o Santos', 'Maria Oliveira', 'Pedro Costa', 'Carla Mendes', 'Lucas Ferreira'];
                            const nameIndex = post.user_id.charCodeAt(0) % names.length;
                            const userName = names[nameIndex];
                            
                            post.user_data = {
                                name: userName,
                                avatar_url: `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=667eea&color=fff`
                            };
                        }
                    }
                    
                    // Inicializar array de rea√ß√µes se n√£o existir
                    if (!post.reactions) {
                        post.reactions = [];
                    }
                    
                } catch (userError) {
                    console.warn('‚ö†Ô∏è Erro ao processar usu√°rio do post:', userError);
                    post.user_data = {
                        name: 'Usu√°rio',
                        avatar_url: 'https://ui-avatars.com/api/?name=Usuario&background=ccc&color=333'
                    };
                    post.reactions = [];
                }
            }
            
            console.log('‚úÖ Dados de usu√°rios processados');
        }

        // Fun√ß√£o getFeedbackButtonForPost - VERS√ÉO REAL
        async function getFeedbackButtonForPost(post) {
            try {
                // Verificar se o usu√°rio atual √© a pessoa mencionada no post
                if (!post.mentioned_user_id || post.mentioned_user_id !== currentUser.id) {
                    return ''; // N√£o mostrar bot√£o se n√£o for a pessoa mencionada
                }
                
                // Verificar se j√° existe feedback para este post
                const { data: existingFeedback, error } = await supabase
                    .from('feedbacks')
                    .select('feedback_text, mentioned_user_id')
                    .eq('post_id', post.id)
                    .eq('mentioned_user_id', currentUser.id)
                    .limit(1);
                
                if (error) {
                    console.error('‚ùå Erro ao verificar feedback existente:', error);
                    return ''; // Em caso de erro, n√£o mostrar bot√£o
                }
                
                if (existingFeedback && existingFeedback.length > 0) {
                    // J√° existe feedback - mostrar o feedback enviado
                    const feedback = existingFeedback[0];
                    const username = currentUser.email?.split('@')[0] || 'Usu√°rio';
                    
                    return `
                        <div class="feedback-section" style="margin-top: 10px; padding: 15px; background: linear-gradient(135deg, #fff3e0, #ffe0b2); border: 1px solid #ff9800; border-radius: 8px;">
                            <div style="color: #e65100; font-weight: bold; margin-bottom: 8px;">
                                üîÑ Feedback (@${username}):
                            </div>
                            <div style="color: #bf360c; line-height: 1.4; font-style: italic;">
                                "${feedback.feedback_text}"
                            </div>
                        </div>
                    `;
                } else {
                    // N√£o existe feedback - mostrar bot√£o para dar feedback
                    return `
                        <div class="feedback-section" style="margin-top: 10px; padding: 10px;">
                            <button class="feedback-btn" onclick="openFeedbackModal('${post.id}')" style="
                                background: linear-gradient(135deg, #f57c00, #ff8f00);
                                color: white;
                                border: none;
                                padding: 10px 16px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: bold;
                                transition: transform 0.2s ease;
                                box-shadow: none;
                                outline: none;
                            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                üîÑ Dar Feedback
                            </button>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('‚ùå Erro na fun√ß√£o getFeedbackButtonForPost:', error);
                return ''; // Em caso de erro, n√£o mostrar bot√£o
            }
        }

        async function renderPosts() {
            const container = document.getElementById('postsContainer');
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="post">
                        <h3 style="text-align: center; color: #764ba2; margin-bottom: 1rem;">üé≠ Bem-vindo ao HoloSpot!</h3>
                        <p style="text-align: center; color: #666;">
                            Seja o primeiro a destacar algu√©m especial! V√° para a aba "‚ú® Destacar" e comece a espalhar reconhecimento.
                        </p>
                    </div>
                `;
                return;
            }

            // Processar posts de forma ass√≠ncrona agora
            const postsHtml = [];
            for (const post of posts) {
                const isFollowing = following.some(f => f.following_id === post.user_id);
                
                // Garantir que reactions seja sempre um array
                if (!Array.isArray(post.reactions)) {
                    post.reactions = [];
                }
                
                const userReactions = post.reactions.filter(r => r.user_id === currentUser.id);
                
                const typeEmojis = {
                    'gratidao': 'üôè', 'gratitude': 'üôè',
                    'memoria': 'üí≠', 'memory': 'üí≠',
                    'conquista': 'üèÜ', 'achievement': 'üèÜ',
                    'inspiracao': '‚ú®', 'inspiration': '‚ú®',
                    'apoio': 'ü§ù', 'support': 'ü§ù',
                    'admiracao': 'üåü', 'admiration': 'üåü'
                };

                const typeNames = {
                    'gratidao': 'Gratid√£o', 'gratitude': 'Gratid√£o',
                    'memoria': 'Mem√≥ria', 'memory': 'Mem√≥ria',
                    'conquista': 'Conquista', 'achievement': 'Conquista',
                    'inspiracao': 'Inspira√ß√£o', 'inspiration': 'Inspira√ß√£o',
                    'apoio': 'Apoio', 'support': 'Apoio',
                    'admiracao': 'Admira√ß√£o', 'admiration': 'Admira√ß√£o'
                };
                
                // Obter bot√£o de feedback usando fun√ß√£o
                const feedbackButton = await getFeedbackButtonForPost(post);
                
                const postHtml = `
                    <div class="post">
                        <div class="post-header">
                            <img class="post-avatar" src="${post.user_data?.avatar_url || ''}" alt="Avatar">
                            <div class="post-author">
                                <div class="post-author-name">${post.user_data?.name || 'Usu√°rio'}</div>
                                <div class="post-author-meta">
                                    <span class="post-author-username">@${post.user_data?.email?.split('@')[0] || 'usuario'}</span>
                                    <span class="post-time-separator">‚Ä¢</span>
                                    <span class="post-time">${formatDateShort(post.created_at)}</span>
                                </div>
                            </div>
                            ${post.user_id !== currentUser.id ? `
                                <button class="follow-btn ${isFollowing ? 'following' : ''}" onclick="toggleFollow('${post.user_id}')">
                                    ${isFollowing ? '‚úì Seguindo' : '+ Seguir'}
                                </button>
                            ` : ''}
                        </div>
                        
                        <div class="post-content">
                            <div class="post-person">Holofotes para: ${post.celebrated_person_name || post.person_name}</div>
                            ${post.type || post.highlight_type ? `
                                <div class="post-type">
                                    ${typeEmojis[post.type || post.highlight_type] || '‚ú®'} ${typeNames[post.type || post.highlight_type] || 'Destaque'}
                                </div>
                            ` : ''}
                            <div class="post-story">${post.content || post.story}</div>
                            ${post.photo_url ? `<img class="post-image" src="${post.photo_url}" alt="Foto do post">` : ''}
                        </div>
                        
                        <div class="post-reactions">
                            <button class="reaction-btn ${userReactions.some(r => r.type === 'touched') ? 'active' : ''}" 
                                    onclick="toggleReaction('${post.id}', 'touched')">
                                ‚ù§Ô∏è ${post.reactions.filter(r => r.type === 'touched').length}
                            </button>
                            <button class="reaction-btn ${userReactions.some(r => r.type === 'grateful') ? 'active' : ''}" 
                                    onclick="toggleReaction('${post.id}', 'grateful')">
                                üôè ${post.reactions.filter(r => r.type === 'grateful').length}
                            </button>
                            <button class="reaction-btn ${userReactions.some(r => r.type === 'inspired') ? 'active' : ''}" 
                                    onclick="toggleReaction('${post.id}', 'inspired')">
                                ‚ú® ${post.reactions.filter(r => r.type === 'inspired').length}
                            </button>
                        </div>
                        
                        ${feedbackButton}
                    </div>
                `;
                
                postsHtml.push(postHtml);
            }

            container.innerHTML = postsHtml.join('');
        }

        async function toggleFollow(userId) {
            try {
                console.log(`üë• Tentando ${following.some(f => f.following_id === userId) ? 'desseguir' : 'seguir'} usu√°rio:`, userId);
                const isFollowing = following.some(f => f.following_id === userId);
                
                if (isFollowing) {
                    // Unfollow
                    try {
                        const unfollowQuery = supabase
                            .from('follows')
                            .delete()
                            .eq('follower_id', currentUser.id)
                            .eq('following_id', userId);
                        
                        await withTimeout(unfollowQuery, 2000);
                        console.log('‚úÖ Unfollow realizado no banco');
                    } catch (unfollowError) {
                        console.warn('‚ö†Ô∏è Erro ao desseguir no banco, atualizando apenas localmente:', unfollowError.message);
                    }
                    
                    following = following.filter(f => f.following_id !== userId);
                    console.log('‚úÖ Usu√°rio removido da lista local de seguindo');
                } else {
                    // Follow
                    try {
                        const followQuery = supabase
                            .from('follows')
                            .insert({
                                follower_id: currentUser.id,
                                following_id: userId
                            });
                        
                        await withTimeout(followQuery, 2000);
                        console.log('‚úÖ Follow realizado no banco');
                    } catch (followError) {
                        console.warn('‚ö†Ô∏è Erro ao seguir no banco, atualizando apenas localmente:', followError.message);
                    }
                    
                    following.push({ following_id: userId });
                    console.log('‚úÖ Usu√°rio adicionado √† lista local de seguindo');
                    
                    // Tentar criar notifica√ß√£o
                    try {
                        await createNotification(userId, 'follow', `${currentUser.user_metadata.name || currentUser.email} come√ßou a te seguir!`);
                        console.log('‚úÖ Notifica√ß√£o de follow criada');
                    } catch (notifError) {
                        console.warn('‚ö†Ô∏è Erro ao criar notifica√ß√£o de follow:', notifError.message);
                    }
                }
                
                // Sempre atualizar contadores e interface
                updateFollowCounts();
                await renderPosts();
                console.log('‚úÖ Interface atualizada ap√≥s follow/unfollow');
                
            } catch (error) {
                console.error('‚ùå Erro cr√≠tico ao seguir/desseguir:', error);
                alert('Erro ao seguir/desseguir usu√°rio. Tente novamente.');
            }
        }

        async function toggleReaction(postId, type) {
            try {
                console.log(`üíñ Tentando ${type} no post:`, postId);
                
                // Buscar post diretamente do banco se n√£o estiver no array global
                let post = posts.find(p => p.id === postId);
                
                if (!post) {
                    console.log('üîç Post n√£o encontrado no array local, buscando no banco...');
                    
                    try {
                        const { data: postData, error: postError } = await supabase
                            .from('posts')
                            .select('*')
                            .eq('id', postId)
                            .single();
                        
                        if (postError || !postData) {
                            console.error('‚ùå Post n√£o encontrado no banco:', postError);
                            return;
                        }
                        
                        // Buscar rea√ß√µes do post
                        const { data: reactions } = await supabase
                            .from('reactions')
                            .select('*')
                            .eq('post_id', postId);
                        
                        postData.reactions = reactions || [];
                        post = postData;
                        
                        // Adicionar ao array global para pr√≥ximas intera√ß√µes
                        posts.push(post);
                        console.log('‚úÖ Post carregado do banco e adicionado ao array local');
                        
                    } catch (fetchError) {
                        console.error('‚ùå Erro ao buscar post:', fetchError);
                        return;
                    }
                }
                
                const existingReaction = post.reactions.find(r => r.user_id === currentUser.id && r.type === type);
                
                if (existingReaction) {
                    // Remove reaction
                    try {
                        await supabase
                            .from('reactions')
                            .delete()
                            .eq('id', existingReaction.id);
                        console.log('‚úÖ Rea√ß√£o removida do banco');
                    } catch (deleteError) {
                        console.warn('‚ö†Ô∏è Erro ao remover rea√ß√£o do banco, removendo apenas localmente:', deleteError.message);
                    }
                    
                    post.reactions = post.reactions.filter(r => r.id !== existingReaction.id);
                    console.log('‚úÖ Rea√ß√£o removida localmente');
                } else {
                    // Add reaction
                    let newReaction = null;
                    
                    try {
                        const { data, error } = await supabase
                            .from('reactions')
                            .insert({
                                post_id: postId,
                                user_id: currentUser.id,
                                type: type
                            })
                            .select()
                            .single();
                        
                        if (error) throw error;
                        
                        newReaction = data;
                        console.log('‚úÖ Rea√ß√£o adicionada no banco');
                    } catch (insertError) {
                        console.warn('‚ö†Ô∏è Erro ao adicionar rea√ß√£o no banco, adicionando apenas localmente:', insertError.message);
                        
                        // Fallback: criar rea√ß√£o local
                        newReaction = {
                            id: `local-${Date.now()}`,
                            post_id: postId,
                            user_id: currentUser.id,
                            type: type,
                            created_at: new Date().toISOString()
                        };
                    }
                    
                    if (newReaction) {
                        post.reactions.push(newReaction);
                        console.log('‚úÖ Rea√ß√£o adicionada localmente');
                        
                        // Tentar criar notifica√ß√£o para o autor do post
                        if (post.user_id !== currentUser.id) {
                            try {
                                const reactionEmoji = { touched: '‚ù§Ô∏è', grateful: 'üôè', inspired: '‚ú®' }[type];
                                const userName = currentUser.user_metadata?.name || currentUser.email || 'Algu√©m';
                                const personName = post.celebrated_person_name || post.person_name || 'uma pessoa especial';
                                
                                await createNotification(
                                    post.user_id, 
                                    'reaction', 
                                    `${userName} reagiu ${reactionEmoji} ao seu post sobre ${personName}`
                                );
                                console.log('‚úÖ Notifica√ß√£o de rea√ß√£o criada');
                            } catch (notifError) {
                                console.warn('‚ö†Ô∏è Erro ao criar notifica√ß√£o de rea√ß√£o:', notifError.message);
                            }
                        }
                    }
                }
                
                // Sempre re-renderizar posts e atualizar estat√≠sticas
                try {
                    await renderPosts();
                    console.log('‚úÖ Posts re-renderizados');
                } catch (renderError) {
                    console.error('‚ùå Erro ao re-renderizar posts:', renderError);
                }
                
                try {
                    updateStats();
                    console.log('‚úÖ Estat√≠sticas atualizadas');
                } catch (statsError) {
                    console.error('‚ùå Erro ao atualizar estat√≠sticas:', statsError);
                }
                
                console.log('‚úÖ Interface atualizada ap√≥s rea√ß√£o');
                
            } catch (error) {
                console.error('‚ùå Erro cr√≠tico ao reagir:', error);
                console.error('‚ùå Stack trace:', error.stack);
                alert('Erro ao reagir ao post. Tente novamente.');
            }
        }

        function openFeedbackModal(postId) {
            console.log('üí¨ Abrindo modal de feedback para post:', postId);
            
            // Verificar se j√° existe modal de feedback e fechar apenas ele
            const existingFeedbackModal = document.querySelector('[id*="feedbackModal"]');
            if (existingFeedbackModal) {
                console.log('‚ö†Ô∏è Modal de feedback j√° existe, fechando antes de abrir novo');
                existingFeedbackModal.remove();
            }
            
            // Encontrar o post
            const post = posts.find(p => p.id === postId);
            if (!post) {
                console.error('‚ùå Post n√£o encontrado:', postId);
                alert('Erro: Post n√£o encontrado.');
                return;
            }
            
            // Criar modal de feedback
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="feedback-modal">
                    <div class="feedback-modal-header">
                        <h3>üîÑ Feedback</h3>
                        <button class="close-btn" onclick="closeFeedbackModal()">√ó</button>
                    </div>
                    <div class="feedback-modal-body">
                        <p><strong>Post sobre:</strong> ${post.celebrated_person_name || post.person_name}</p>
                        <p><strong>Autor:</strong> ${post.user_data?.name || 'Usu√°rio'}</p>
                        <div class="form-group">
                            <label class="form-label">Seu feedback:</label>
                            <textarea id="feedbackText" class="form-input" rows="4" 
                                placeholder="Compartilhe como voc√™ se sentiu ao ser destacado..."></textarea>
                        </div>
                    </div>
                    <div class="feedback-modal-footer">
                        <button class="btn-primary" onclick="submitFeedback('${postId}')">Enviar Feedback</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Fechar modal clicando fora
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeFeedbackModal();
                }
            });
            
            // Focar no textarea
            setTimeout(() => {
                document.getElementById('feedbackText').focus();
            }, 100);
        }

        function closeFeedbackModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        async function submitFeedback(postId) {
            const feedbackText = document.getElementById('feedbackText').value.trim();
            
            if (!feedbackText) {
                alert('Por favor, escreva seu feedback.');
                return;
            }
            
            try {
                console.log('üí¨ Enviando feedback para post:', postId);
                
                const post = posts.find(p => p.id === postId);
                if (!post) {
                    throw new Error('Post n√£o encontrado');
                }
                
                // Tentar salvar no banco
                try {
                    const { data, error } = await supabase
                        .from('feedbacks')
                        .insert({
                            post_id: postId,
                            author_id: post.user_id,
                            mentioned_user_id: currentUser.id,
                            feedback_text: feedbackText
                        });
                    
                    if (error) throw error;
                    console.log('‚úÖ Feedback salvo no banco');
                } catch (dbError) {
                    console.warn('‚ö†Ô∏è Erro ao salvar feedback no banco:', dbError.message);
                    // Continuar mesmo com erro no banco
                }
                
                // Marcar como feedback dado localmente
                post.feedback_given = true;
                
                // Tentar criar notifica√ß√£o para o autor do post
                try {
                    const userName = currentUser.user_metadata?.name || currentUser.email || 'Algu√©m';
                    await createNotification(
                        post.user_id,
                        'feedback',
                        `${userName} deu feedback sobre o post que voc√™ fez destacando-o!`
                    );
                    console.log('‚úÖ Notifica√ß√£o de feedback criada');
                } catch (notifError) {
                    console.warn('‚ö†Ô∏è Erro ao criar notifica√ß√£o de feedback:', notifError.message);
                }
                
                // Fechar modal e atualizar interface
                closeFeedbackModal();
                await renderPosts();
                
                alert('Feedback enviado com sucesso! O autor do post foi notificado.');
                console.log('‚úÖ Feedback enviado com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao enviar feedback:', error);
                alert('Erro ao enviar feedback. Tente novamente.');
            }
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Por favor, selecione apenas arquivos de imagem.');
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('A imagem deve ter no m√°ximo 5MB.');
                return;
            }
            
            selectedPhotoFile = file;
            
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('photoPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
            
            console.log('üì∑ Foto selecionada:', file.name, file.size, 'bytes');
        }

        function removePhoto() {
            selectedPhotoFile = null;
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('photoUpload').value = '';
        }

        async function uploadPhoto(file) {
            try {
                console.log('üì∏ Iniciando upload da foto:', file.name);
                
                // Verificar se o bucket existe e est√° configurado
                try {
                    const { data: buckets, error: bucketsError } = await supabase.storage.listBuckets();
                    if (bucketsError) throw bucketsError;
                    
                    const photoBucket = buckets.find(b => b.name === 'photos');
                    if (!photoBucket) {
                        console.warn('‚ö†Ô∏è Bucket "photos" n√£o encontrado');
                        throw new Error('Bucket de fotos n√£o configurado');
                    }
                    console.log('‚úÖ Bucket "photos" encontrado');
                } catch (bucketError) {
                    console.warn('‚ö†Ô∏è Erro ao verificar bucket:', bucketError.message);
                    throw new Error('Erro na configura√ß√£o do storage');
                }
                
                // Gerar nome √∫nico para o arquivo
                const fileExt = file.name.split('.').pop();
                const fileName = `${currentUser.id}_${Date.now()}.${fileExt}`;
                console.log('üìù Nome do arquivo:', fileName);
                
                // Fazer upload do arquivo
                const { data, error } = await supabase.storage
                    .from('photos')
                    .upload(fileName, file, {
                        cacheControl: '3600',
                        upsert: false
                    });
                
                if (error) {
                    console.error('‚ùå Erro no upload:', error);
                    throw error;
                }
                
                console.log('‚úÖ Upload realizado com sucesso:', data.path);
                
                // Obter URL p√∫blica
                const { data: urlData } = supabase.storage
                    .from('photos')
                    .getPublicUrl(fileName);
                
                const publicUrl = urlData.publicUrl;
                console.log('‚úÖ URL p√∫blica gerada:', publicUrl);
                
                return publicUrl;
                
            } catch (error) {
                console.error('‚ùå Erro cr√≠tico no upload:', error);
                throw new Error(`Falha no upload: ${error.message}`);
            }
        }

        async function findMentionedUserId(personName) {
            try {
                console.log('üîç Buscando ID do usu√°rio mencionado:', personName);
                
                // Extrair username se for uma men√ß√£o (@username)
                let searchTerm = personName;
                if (personName.startsWith('@')) {
                    searchTerm = personName.substring(1); // Remove @
                }
                
                // Buscar por email exato (incluindo dom√≠nios reais dos usu√°rios)
                const emailPatterns = [
                    `${searchTerm}@gmail.com`,
                    `${searchTerm}@hotmail.com`,
                    `${searchTerm}@outlook.com`,
                    `${searchTerm}@yahoo.com`,
                    `${searchTerm}@b11c.com`,
                    `${searchTerm}@vockan.com`
                ];
                
                for (const email of emailPatterns) {
                    const { data, error } = await supabase
                        .from('profiles')
                        .select('id')
                        .eq('email', email)
                        .single();
                    
                    if (data && !error) {
                        console.log('‚úÖ Usu√°rio encontrado por email:', email, 'ID:', data.id);
                        return data.id;
                    }
                }
                
                // Buscar por nome (fallback)
                const { data: nameData, error: nameError } = await supabase
                    .from('profiles')
                    .select('id')
                    .ilike('name', `%${searchTerm}%`)
                    .single();
                
                if (nameData && !nameError) {
                    console.log('‚úÖ Usu√°rio encontrado por nome:', searchTerm, 'ID:', nameData.id);
                    return nameData.id;
                }
                
                console.log('‚ö†Ô∏è Usu√°rio n√£o encontrado:', personName);
                return null;
                
            } catch (error) {
                console.error('‚ùå Erro ao buscar ID do usu√°rio:', error);
                return null;
            }
        }

        async function createPost() {
            const personName = document.getElementById('personName').value.trim();
            const storyText = document.getElementById('storyText').value.trim();
            
            if (!personName || !storyText) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }

            if (!selectedHighlightType) {
                alert('Por favor, selecione um tipo de destaque.');
                return;
            }

            // Map Portuguese types to English for database constraint
            const typeMapping = {
                'gratidao': 'gratitude',
                'memoria': 'memory',
                'conquista': 'achievement',
                'inspiracao': 'inspiration',
                'apoio': 'support',
                'admiracao': 'admiration'
            };
            
            const mappedType = typeMapping[selectedHighlightType] || selectedHighlightType;
            
            const createBtn = document.getElementById('createPostBtn');
            createBtn.disabled = true;
            createBtn.textContent = 'Criando...';
            
            try {
                let photoUrl = null;
                
                // Upload photo if selected
                if (selectedPhotoFile) {
                    try {
                        console.log('üì∏ Tentando upload da foto...');
                        createBtn.textContent = 'Fazendo upload da foto...';
                        photoUrl = await uploadPhoto(selectedPhotoFile);
                        console.log('‚úÖ Upload da foto conclu√≠do:', photoUrl);
                    } catch (uploadError) {
                        console.error('‚ùå Erro no upload da foto:', uploadError);
                        
                        // Perguntar ao usu√°rio se quer continuar sem foto
                        const continueWithoutPhoto = confirm(
                            `Erro ao fazer upload da foto: ${uploadError.message}\n\n` +
                            'Deseja continuar criando o post sem a foto?'
                        );
                        
                        if (!continueWithoutPhoto) {
                            createBtn.disabled = false;
                            createBtn.textContent = '‚ú® Destacar Pessoa';
                            return;
                        }
                        
                        console.log('‚ö†Ô∏è Continuando sem foto por escolha do usu√°rio');
                        photoUrl = null;
                    }
                }
                
                // Create post
                createBtn.textContent = 'Criando post...';
                console.log('üìù Criando post no banco de dados...');
                
                // Buscar ID do usu√°rio mencionado
                let mentionedUserId = null;
                try {
                    mentionedUserId = await findMentionedUserId(personName);
                    console.log('üîç ID do usu√°rio mencionado:', mentionedUserId);
                } catch (error) {
                    console.warn('‚ö†Ô∏è Erro ao buscar ID do usu√°rio mencionado:', error);
                }
                
                try {
                    const { data, error } = await supabase
                        .from('posts')
                        .insert({
                            user_id: currentUser.id,
                            celebrated_person_name: personName,
                            content: storyText,
                            photo_url: photoUrl,
                            type: mappedType,
                            mentioned_user_id: mentionedUserId
                        })
                        .select()
                        .single();
                    
                    if (error) {
                        console.error('‚ùå Erro ao criar post no banco:', error);
                        throw error;
                    }
                    
                    console.log('‚úÖ Post criado no banco com sucesso');
                    
                    // Add user data and reactions array to the new post
                    data.user_data = {
                        name: currentUser.user_metadata?.name || currentUser.email || 'Usu√°rio',
                        avatar_url: currentUser.user_metadata?.avatar_url || ''
                    };
                    data.reactions = [];
                    
                    // Add to posts array at the beginning
                    posts.unshift(data);
                    console.log('‚úÖ Post adicionado √† lista local');
                    
                } catch (postError) {
                    console.error('‚ùå Erro ao criar post:', postError);
                    
                    // Fallback: criar post apenas localmente
                    console.warn('‚ö†Ô∏è Criando post apenas localmente como fallback');
                    const localPost = {
                        id: `local-${Date.now()}`,
                        user_id: currentUser.id,
                        celebrated_person_name: personName,
                        content: storyText,
                        photo_url: photoUrl,
                        type: mappedType,
                        created_at: new Date().toISOString(),
                        user_data: {
                            name: currentUser.user_metadata?.name || currentUser.email || 'Usu√°rio',
                            avatar_url: currentUser.user_metadata?.avatar_url || ''
                        },
                        reactions: []
                    };
                    
                    posts.unshift(localPost);
                    console.log('‚úÖ Post local criado como fallback');
                    
                    alert('Post criado localmente. Pode haver problemas de sincroniza√ß√£o com o servidor.');
                }
                
                // Clear form
                document.getElementById('personName').value = '';
                document.getElementById('storyText').value = '';
                removePhoto();
                
                // Clear highlight type selection
                document.querySelectorAll('.highlight-type').forEach(el => {
                    el.classList.remove('selected');
                });
                selectedHighlightType = null;
                
                // Switch to home tab and re-render
                switchTab('inicio');
                renderPosts();
                updateStats();
                
                trackEvent('post_created', { 
                    person_name: personName, 
                    has_photo: !!photoUrl,
                    story_length: storyText.length,
                    highlight_type: selectedHighlightType
                });
                
                alert('‚ú® Post criado com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro ao criar post:', error);
                alert('Erro ao criar post: ' + error.message);
            } finally {
                createBtn.disabled = false;
                createBtn.textContent = '‚ú® Destacar Pessoa';
            }
        }

        async function createNotification(userId, type, message) {
            try {
                console.log('üîî Criando notifica√ß√£o:', { userId, type, message });
                
                const insertQuery = supabase
                    .from('notifications')
                    .insert({
                        user_id: userId,
                        type: type,
                        message: message,
                        from_user_id: currentUser.id
                    });
                
                await withTimeout(insertQuery, 2000);
                console.log('‚úÖ Notifica√ß√£o criada no banco');
                
            } catch (error) {
                console.error('‚ùå Erro ao criar notifica√ß√£o:', error);
            }
        }

        async function loadNotifications() {
            try {
                console.log('üîî Carregando notifica√ß√µes...');
                console.log('üîç Carregando notifica√ß√µes reais do Supabase com timeout...');
                
                const notificationsQuery = supabase
                    .from('notifications')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                const { data, error } = await withTimeout(notificationsQuery, 2000);
                
                if (error) {
                    console.error('‚ùå Erro ao carregar notifica√ß√µes:', error);
                    throw error;
                }
                
                console.log(`‚úÖ ${data?.length || 0} notifica√ß√µes reais carregadas do banco`);
                notifications = data || [];
                
                updateNotificationBadge();
                renderNotifications();
                console.log('‚úÖ Notifica√ß√µes processadas e renderizadas');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar notifica√ß√µes, mantendo array vazio:', error);
                
                // Manter array vazio em caso de erro
                notifications = [];
                
                console.log('‚úÖ Array de notifica√ß√µes vazio configurado devido ao erro');
                
                updateNotificationBadge();
                renderNotifications();
                console.log('‚úÖ Interface de notifica√ß√µes renderizada sem dados');
            }
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function renderNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            
            if (notifications.length === 0) {
                dropdown.innerHTML = `
                    <div class="notification-item">
                        <strong>Nenhuma notifica√ß√£o</strong><br>
                        <small>Voc√™ receber√° notifica√ß√µes quando algu√©m interagir com seus posts</small>
                    </div>
                `;
                return;
            }
            
            dropdown.innerHTML = notifications.map(notification => `
                <div class="notification-item ${!notification.read ? 'unread' : ''}" 
                     onclick="markNotificationAsRead('${notification.id}')">
                    <strong>${notification.message}</strong><br>
                    <small>${formatDate(notification.created_at)}</small>
                </div>
            `).join('');
        }

        async function markNotificationAsRead(notificationId) {
            try {
                console.log('üìù Marcando notifica√ß√£o como lida:', notificationId);
                
                // Tentar atualizar no banco com timeout
                try {
                    const updateQuery = supabase
                        .from('notifications')
                        .update({ read: true })
                        .eq('id', notificationId);
                    
                    await withTimeout(updateQuery, 2000);
                    console.log('‚úÖ Notifica√ß√£o marcada como lida no banco');
                } catch (updateError) {
                    console.warn('‚ö†Ô∏è Erro ao atualizar no banco, marcando apenas localmente:', updateError.message);
                }
                
                // Sempre atualizar estado local
                const notification = notifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.read = true;
                    console.log('‚úÖ Notifica√ß√£o marcada como lida localmente');
                }
                
                updateNotificationBadge();
                renderNotifications();
                
            } catch (error) {
                console.error('‚ùå Erro ao marcar notifica√ß√£o como lida:', error);
            }
        }

        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function updateStats() {
            const userPosts = posts.filter(p => p.user_id === currentUser.id);
            const userTotalReactions = userPosts.reduce((sum, post) => {
                // Garantir que reactions seja um array
                const reactions = Array.isArray(post.reactions) ? post.reactions : [];
                return sum + reactions.length;
            }, 0);
            const uniquePeople = new Set(userPosts.map(p => p.celebrated_person_name || p.person_name)).size;
            
            // Profile tab stats - verificar se elementos existem
            const postsCountEl = document.getElementById('userPostsCount');
            if (postsCountEl) postsCountEl.textContent = userPosts.length;
            
            const reactionsEl = document.getElementById('userReactionsReceived');
            if (reactionsEl) reactionsEl.textContent = userTotalReactions;
            
            const peopleEl = document.getElementById('userPeopleHighlighted');
            if (peopleEl) peopleEl.textContent = uniquePeople;
            
            const followersEl = document.getElementById('userFollowersCount');
            if (followersEl) followersEl.textContent = followers.length;
            
            // Impact tab stats - verificar se elementos existem
            const totalReactions = posts.reduce((sum, post) => {
                const reactions = Array.isArray(post.reactions) ? post.reactions : [];
                return sum + reactions.length;
            }, 0);
            const estimatedReach = totalReactions * 3 + userPosts.length * 5; // More realistic calculation
            
            const totalReachEl = document.getElementById('totalReachCount');
            if (totalReachEl) totalReachEl.textContent = estimatedReach;
            
            const totalReactionsEl = document.getElementById('totalReactionsCount');
            if (totalReactionsEl) totalReactionsEl.textContent = totalReactions;
            
            const avgReactionsEl = document.getElementById('averageReactionsCount');
            if (avgReactionsEl) avgReactionsEl.textContent = posts.length > 0 ? Math.round(totalReactions / posts.length) : 0;
            
            // Growth calculation (mock for now)
            const growthPercentage = Math.min(userPosts.length * 10, 200);
            const growthEl = document.getElementById('impactGrowthCount');
            if (growthEl) growthEl.textContent = `+${growthPercentage}%`;
            
            // Update progress bars
            updateProgressBars(userPosts.length, totalReactions);
            
            // Update personalized tip
            updatePersonalizedTip(userPosts.length, totalReactions);
        }

        function updateProgressBars(postsCount, reactionsCount) {
            // First highlight achievement
            const firstProgress = Math.min(postsCount / 1 * 100, 100);
            const firstProgressEl = document.getElementById('firstHighlightProgress');
            if (firstProgressEl) firstProgressEl.style.width = firstProgress + '%';
            const firstTextEl = document.getElementById('firstHighlightText');
            if (firstTextEl) firstTextEl.textContent = `${Math.min(postsCount, 1)}/1`;
            
            // Multiplier achievement
            const multiplierValue = 1.0 + (Math.min(postsCount, 10) * 0.1);
            const multiplierProgress = Math.min(postsCount / 10 * 100, 100);
            const multiplierProgressEl = document.getElementById('multiplierProgress');
            if (multiplierProgressEl) multiplierProgressEl.style.width = multiplierProgress + '%';
            const multiplierTextEl = document.getElementById('multiplierText');
            if (multiplierTextEl) multiplierTextEl.textContent = `${multiplierValue.toFixed(1)}x`;
            
            // Inspirer achievement
            const inspirerProgress = Math.min(reactionsCount / 50 * 100, 100);
            const inspirerProgressEl = document.getElementById('inspirerProgress');
            if (inspirerProgressEl) inspirerProgressEl.style.width = inspirerProgress + '%';
            const inspirerTextEl = document.getElementById('inspirerText');
            if (inspirerTextEl) inspirerTextEl.textContent = `${Math.min(reactionsCount, 50)}/50`;
            
            // Monthly goal
            const monthlyProgress = Math.min(postsCount / 20 * 100, 100);
            const monthlyProgressEl = document.getElementById('monthlyGoalProgress');
            if (monthlyProgressEl) monthlyProgressEl.style.width = monthlyProgress + '%';
            const monthlyTextEl = document.getElementById('monthlyGoalText');
            if (monthlyTextEl) monthlyTextEl.textContent = `${Math.min(postsCount, 20)}/20`;
            
            // Engagement
            const engagementRate = postsCount > 0 ? Math.min((reactionsCount / postsCount) * 10, 100) : 0;
            const engagementProgressEl = document.getElementById('engagementProgress');
            if (engagementProgressEl) engagementProgressEl.style.width = engagementRate + '%';
            const engagementTextEl = document.getElementById('engagementText');
            if (engagementTextEl) engagementTextEl.textContent = Math.round(engagementRate) + '%';
        }

        function updatePersonalizedTip(postsCount, reactionsCount) {
            let tip = '';
            
            if (postsCount === 0) {
                tip = 'Comece destacando algu√©m especial! Cada pessoa merece reconhecimento pelo que faz de bom.';
            } else if (postsCount < 5) {
                tip = 'Voc√™ est√° no caminho certo! Continue destacando pessoas que fazem a diferen√ßa na sua vida.';
            } else if (reactionsCount < postsCount * 2) {
                tip = 'Seus posts est√£o inspirando pessoas! Tente adicionar fotos para aumentar o engajamento.';
            } else {
                tip = 'Incr√≠vel! Voc√™ est√° criando uma onda de positividade. Continue espalhando reconhecimento!';
            }
            
            const tipEl = document.getElementById('personalizedTip');
            if (tipEl) tipEl.textContent = tip;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 1) {
                return 'Agora mesmo';
            } else if (diffInMinutes < 60) {
                return `H√° ${diffInMinutes} minuto${diffInMinutes > 1 ? 's' : ''}`;
            } else if (diffInMinutes < 1440) { // 24 hours
                const hours = Math.floor(diffInMinutes / 60);
                return `H√° ${hours} hora${hours > 1 ? 's' : ''}`;
            } else {
                const days = Math.floor(diffInMinutes / 1440);
                return `H√° ${days} dia${days > 1 ? 's' : ''}`;
            }
        }

        function formatDateShort(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 1) {
                return 'agora';
            } else if (diffInMinutes < 60) {
                return `${diffInMinutes}m`;
            } else if (diffInMinutes < 1440) { // 24 hours
                const hours = Math.floor(diffInMinutes / 60);
                return `${hours}h`;
            } else {
                const days = Math.floor(diffInMinutes / 1440);
                return `${days}d`;
            }
        }

        async function showFollowingModal() {
            console.log('üë• Abrindo modal de seguindo...');
            
            // Verificar se j√° existe modal de seguindo e fechar apenas ele
            const existingFollowingModal = document.getElementById('followingModal');
            if (existingFollowingModal) {
                console.log('‚ö†Ô∏è Modal de seguindo j√° existe, fechando antes de abrir novo');
                existingFollowingModal.remove();
            }
            
            const followingList = await Promise.all(following.map(async f => {
                // Tentar buscar dados reais do usu√°rio incluindo avatar
                let userName = 'Usu√°rio';
                let userAvatar = '';
                
                try {
                    const userQuery = supabase
                        .from('profiles')
                        .select('name, email, avatar_url')
                        .eq('id', f.following_id)
                        .single();
                    
                    const { data: userData } = await withTimeout(userQuery, 1000);
                    if (userData) {
                        userName = userData.name || userData.email || 'Usu√°rio';
                        userAvatar = userData.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=667eea&color=fff`;
                    } else {
                        // Fallback com nome baseado no ID
                        const names = ['Ana Silva', 'Jo√£o Santos', 'Maria Oliveira', 'Pedro Costa', 'Carla Mendes', 'Lucas Ferreira'];
                        const nameIndex = f.following_id.charCodeAt(0) % names.length;
                        userName = names[nameIndex];
                        userAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=667eea&color=fff`;
                    }
                } catch (error) {
                    // Fallback com nome baseado no ID
                    const names = ['Ana Silva', 'Jo√£o Santos', 'Maria Oliveira', 'Pedro Costa', 'Carla Mendes', 'Lucas Ferreira'];
                    const nameIndex = f.following_id.charCodeAt(0) % names.length;
                    userName = names[nameIndex];
                    userAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=667eea&color=fff`;
                }
                
                return `
                    <div class="follow-item">
                        <img src="${userAvatar}" 
                             alt="Avatar" style="width: 32px; height: 32px; border-radius: 50%; margin-right: 10px;">
                        <span>${userName}</span>
                    </div>
                `;
            }));
            
            const modal = `
                <div id="followingModal" class="modal-overlay" onclick="closeFollowingModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>Seguindo (${following.length})</h3>
                            <button class="modal-close" onclick="closeFollowingModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="follow-list">
                                ${followingList.length > 0 ? followingList.join('') : '<div class="empty-state"><div class="empty-state-icon">üë•</div><p>Voc√™ ainda n√£o segue ningu√©m.</p></div>'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        async function showFollowersModal() {
            console.log('üë• Abrindo modal de seguidores...');
            
            // Verificar se j√° existe modal de seguidores e fechar apenas ele
            const existingFollowersModal = document.getElementById('followersModal');
            if (existingFollowersModal) {
                console.log('‚ö†Ô∏è Modal de seguidores j√° existe, fechando antes de abrir novo');
                existingFollowersModal.remove();
            }
            
            const followersList = await Promise.all(followers.map(async f => {
                // Tentar buscar dados reais do usu√°rio incluindo avatar
                let userName = 'Usu√°rio';
                let userAvatar = '';
                
                try {
                    const userQuery = supabase
                        .from('profiles')
                        .select('name, email, avatar_url')
                        .eq('id', f.follower_id)
                        .single();
                    
                    const { data: userData } = await withTimeout(userQuery, 1000);
                    if (userData) {
                        userName = userData.name || userData.email || 'Usu√°rio';
                        userAvatar = userData.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=764ba2&color=fff`;
                    } else {
                        // Fallback com nome baseado no ID
                        const names = ['Ana Silva', 'Jo√£o Santos', 'Maria Oliveira', 'Pedro Costa', 'Carla Mendes', 'Lucas Ferreira'];
                        const nameIndex = f.follower_id.charCodeAt(0) % names.length;
                        userName = names[nameIndex];
                        userAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=764ba2&color=fff`;
                    }
                } catch (error) {
                    // Fallback com nome baseado no ID
                    const names = ['Ana Silva', 'Jo√£o Santos', 'Maria Oliveira', 'Pedro Costa', 'Carla Mendes', 'Lucas Ferreira'];
                    const nameIndex = f.follower_id.charCodeAt(0) % names.length;
                    userName = names[nameIndex];
                    userAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=764ba2&color=fff`;
                }
                
                return `
                    <div class="follow-item">
                        <img src="${userAvatar}" 
                             alt="Avatar" style="width: 32px; height: 32px; border-radius: 50%; margin-right: 10px;">
                        <span>${userName}</span>
                    </div>
                `;
            }));
            
            const modal = `
                <div id="followersModal" class="modal-overlay" onclick="closeFollowersModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>Seguidores (${followers.length})</h3>
                            <button class="modal-close" onclick="closeFollowersModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="follow-list">
                                ${followersList.length > 0 ? followersList.join('') : '<div class="empty-state"><div class="empty-state-icon">üë§</div><p>Voc√™ ainda n√£o tem seguidores.</p></div>'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        function closeFollowingModal() {
            const modal = document.getElementById('followingModal');
            if (modal) {
                modal.remove();
            }
        }

        function closeFollowersModal() {
            const modal = document.getElementById('followersModal');
            if (modal) {
                modal.remove();
            }
        }

        // Sistema de Men√ß√µes - Fun√ß√£o para carregar usu√°rios
        async function loadMentionUsers() {
            try {
                console.log('üë• Carregando usu√°rios para men√ß√µes...');
                
                const userQuery = supabase
                    .from('profiles')
                    .select('id, name, email, avatar_url')
                    .limit(50);
                
                const { data: users, error } = await withTimeout(userQuery, 3000);
                
                if (users && !error) {
                    mentionUsers = users.map(user => ({
                        id: user.id,
                        name: user.name || user.email || 'Usu√°rio',
                        username: user.email ? user.email.split('@')[0] : 'usuario',
                        avatar: user.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name || user.email || 'Usuario')}&background=667eea&color=fff`
                    }));
                    console.log(`‚úÖ ${mentionUsers.length} usu√°rios carregados para men√ß√µes`);
                } else {
                    console.warn('‚ö†Ô∏è Erro ao carregar usu√°rios, mantendo array vazio');
                    mentionUsers = [];
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar usu√°rios para men√ß√µes:', error);
                mentionUsers = [
                    { id: 'user1', name: 'Ana Silva', username: 'ana.silva', avatar: 'https://ui-avatars.com/api/?name=Ana+Silva&background=667eea&color=fff' },
                    { id: 'user2', name: 'Jo√£o Santos', username: 'joao.santos', avatar: 'https://ui-avatars.com/api/?name=Joao+Santos&background=667eea&color=fff' },
                    { id: 'user3', name: 'Maria Oliveira', username: 'maria.oliveira', avatar: 'https://ui-avatars.com/api/?name=Maria+Oliveira&background=667eea&color=fff' }
                ];
            }
        }

        // Sistema de Men√ß√µes - Configurar event listeners
        function setupMentionsSystem() {
            const input = document.getElementById('personName');
            const autocomplete = document.getElementById('mentionsAutocomplete');
            
            if (!input || !autocomplete) {
                console.warn('‚ö†Ô∏è Elementos de men√ß√£o n√£o encontrados');
                return;
            }
            
            console.log('‚úÖ Configurando sistema de men√ß√µes no campo Nome da pessoa...');
            
            input.addEventListener('input', handleMentionInput);
            input.addEventListener('keydown', handleMentionKeydown);
            
            // Fechar autocomplete ao clicar fora
            document.addEventListener('click', function(e) {
                if (!input.contains(e.target) && !autocomplete.contains(e.target)) {
                    hideMentionsAutocomplete();
                }
            });
        }

        // Sistema de Men√ß√µes - Detectar @ no input
        function handleMentionInput(event) {
            const textarea = event.target;
            const text = textarea.value;
            const cursorPos = textarea.selectionStart;
            
            // Procurar por @ antes do cursor
            const beforeCursor = text.substring(0, cursorPos);
            const atMatch = beforeCursor.match(/@(\w*)$/);
            
            if (atMatch) {
                console.log('üéØ @ detectado, query:', atMatch[1]);
                mentionStartPos = cursorPos - atMatch[0].length;
                currentMentionQuery = atMatch[1].toLowerCase();
                showMentionsAutocomplete(currentMentionQuery);
            } else {
                hideMentionsAutocomplete();
            }
        }

        // Sistema de Men√ß√µes - Mostrar lista de usu√°rios
        function showMentionsAutocomplete(query) {
            const autocomplete = document.getElementById('mentionsAutocomplete');
            
            // Filtrar usu√°rios baseado na query E excluir o usu√°rio atual
            const filteredUsers = mentionUsers.filter(user => {
                // Excluir o pr√≥prio usu√°rio logado
                if (currentUser && (user.id === currentUser.id || user.username === (currentUser.email ? currentUser.email.split('@')[0] : ''))) {
                    return false;
                }
                
                // Filtrar por query
                return user.name.toLowerCase().includes(query) || 
                       user.username.toLowerCase().includes(query);
            }).slice(0, 5); // M√°ximo 5 resultados
            
            if (filteredUsers.length === 0) {
                hideMentionsAutocomplete();
                return;
            }
            
            console.log(`üìã Mostrando ${filteredUsers.length} usu√°rios para men√ß√£o (excluindo usu√°rio atual)`);
            
            const html = filteredUsers.map((user, index) => `
                <div class="mention-item" data-index="${index}" onclick="selectMention(${index})">
                    <img src="${user.avatar}" alt="${user.name}">
                    <div class="mention-info">
                        <div class="mention-name">${user.name}</div>
                        <div class="mention-username">@${user.username}</div>
                    </div>
                </div>
            `).join('');
            
            autocomplete.innerHTML = html;
            autocomplete.style.display = 'block';
            selectedMentionIndex = 0;
            updateMentionSelection();
        }

        // Sistema de Men√ß√µes - Esconder autocomplete
        function hideMentionsAutocomplete() {
            const autocomplete = document.getElementById('mentionsAutocomplete');
            autocomplete.style.display = 'none';
            selectedMentionIndex = -1;
            mentionStartPos = -1;
            currentMentionQuery = '';
        }

        // Sistema de Men√ß√µes - Atualizar sele√ß√£o visual
        function updateMentionSelection() {
            const items = document.querySelectorAll('.mention-item');
            items.forEach((item, index) => {
                if (index === selectedMentionIndex) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        // Sistema de Men√ß√µes - Navega√ß√£o por teclado
        function handleMentionKeydown(event) {
            const autocomplete = document.getElementById('mentionsAutocomplete');
            if (autocomplete.style.display === 'none') return;
            
            const items = autocomplete.querySelectorAll('.mention-item');
            
            switch (event.key) {
                case 'ArrowDown':
                    event.preventDefault();
                    selectedMentionIndex = Math.min(selectedMentionIndex + 1, items.length - 1);
                    updateMentionSelection();
                    break;
                    
                case 'ArrowUp':
                    event.preventDefault();
                    selectedMentionIndex = Math.max(selectedMentionIndex - 1, -1);
                    updateMentionSelection();
                    break;
                    
                case 'Enter':
                case 'Tab':
                    if (selectedMentionIndex >= 0) {
                        event.preventDefault();
                        selectMention(selectedMentionIndex);
                    }
                    break;
                    
                case 'Escape':
                    hideMentionsAutocomplete();
                    break;
            }
        }

        // Sistema de Men√ß√µes - Selecionar usu√°rio
        function selectMention(index) {
            const input = document.getElementById('personName');
            
            // Filtrar usu√°rios novamente para pegar o correto (excluindo usu√°rio atual)
            const filteredUsers = mentionUsers.filter(user => {
                // Excluir o pr√≥prio usu√°rio logado
                if (currentUser && (user.id === currentUser.id || user.username === (currentUser.email ? currentUser.email.split('@')[0] : ''))) {
                    return false;
                }
                
                // Filtrar por query
                return user.name.toLowerCase().includes(currentMentionQuery) || 
                       user.username.toLowerCase().includes(currentMentionQuery);
            }).slice(0, 5);
            
            if (index >= filteredUsers.length) return;
            
            const selectedUser = filteredUsers[index];
            const text = input.value;
            const beforeMention = text.substring(0, mentionStartPos);
            const afterCursor = text.substring(input.selectionStart);
            
            // Substituir @query por @username
            const newText = beforeMention + `@${selectedUser.username} ` + afterCursor;
            input.value = newText;
            
            // Posicionar cursor ap√≥s a men√ß√£o
            const newCursorPos = mentionStartPos + selectedUser.username.length + 2;
            input.setSelectionRange(newCursorPos, newCursorPos);
            
            console.log(`‚úÖ Usu√°rio @${selectedUser.username} mencionado no campo Nome`);
            
            hideMentionsAutocomplete();
            input.focus();
        }

        // Listen for auth state changes
        supabase.auth.onAuthStateChange(async (event, session) => {
            if (event === 'SIGNED_IN') {
                currentUser = session.user;
                showApp();
                await loadUserData();
                await loadPosts();
                await loadNotifications();
                updateStats();
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                showLogin();
            }
        });

        console.log('‚úÖ HoloSpot v8 carregado com sucesso!');
    </script>
</body>
</html>
